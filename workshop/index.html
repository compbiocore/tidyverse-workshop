



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Visualization with tidyverse Workshop">
      
      
        <link rel="canonical" href="https://compbiocore.github.io/workshop/">
      
      
        <meta name="author" content="August Guang">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0, mkdocs-material-3.0.3">
    
    
      
        <title>Notebooks - Computational Biology Core - Brown University</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../styles/dark_mode.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#preamble" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://compbiocore.github.io/" title="Computational Biology Core - Brown University" class="md-header-nav__button md-logo">
          
            <img src="../images/cbc-logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Computational Biology Core - Brown University
              </span>
              <span class="md-header-nav__topic">
                Notebooks
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/compbiocore/tidyverse-workshop/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://compbiocore.github.io/" title="Computational Biology Core - Brown University" class="md-nav__button md-logo">
      
        <img src="../images/cbc-logo.svg" width="48" height="48">
      
    </a>
    Computational Biology Core - Brown University
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/compbiocore/tidyverse-workshop/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Notebooks
      </label>
    
    <a href="./" title="Notebooks" class="md-nav__link md-nav__link--active">
      Notebooks
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-this-workshop-covers-and-does-not-cover" title="What this workshop covers and does not cover" class="md-nav__link">
    What this workshop covers and does not cover
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-this-workshop-covers-and-does-not-cover" title="What this workshop covers and does not cover" class="md-nav__link">
    What this workshop covers and does not cover
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/compbiocore/tidyverse-workshop/edit/master/docs/workshop.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="preamble">Preamble</h1>
<p>Most of this workshop is taken from Hadley's <a href="https://r4ds.had.co.nz/">R for Data Science</a> book. You can find more examples, explanations and exercises there if you want.</p>
<h2 id="what-this-workshop-covers-and-does-not-cover">What this workshop covers and does not cover</h2>
<p>In this workshop you'll learn principles behind exploratory data analysis and visualization, including tidying and transforming data to answer questions you might want to ask. What you will <em>not</em> learn is how to make specific plots.</p>
<h1 id="package-prerequisites">Package prerequisites</h1>
<p>Packages that required in this workshop are <strong>tidyverse</strong>, which includes the packages <strong>ggplot2</strong>, <strong>dplyr</strong>, <strong>purrr</strong>, and others, <strong>gridExtra</strong> which helps with arranging plots next to each other, <strong>ggrepel</strong> which helps with plot labels and <strong>maps</strong> which is for map data.</p>
<div class="codehilite"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gridExtra</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">maps</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">──</span> <span class="n">Attaching</span> <span class="n">packages</span> <span class="err">───────────────────────────────────────</span> <span class="n">tidyverse</span> <span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">1</span> <span class="err">──</span>
<span class="err">✔</span> <span class="n">ggplot2</span> <span class="mi">3</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span>       <span class="err">✔</span> <span class="n">purrr</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span>  
<span class="err">✔</span> <span class="n">tibble</span>  <span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>       <span class="err">✔</span> <span class="n">dplyr</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
<span class="err">✔</span> <span class="n">tidyr</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">2</span>       <span class="err">✔</span> <span class="n">stringr</span> <span class="mi">1</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">0</span>  
<span class="err">✔</span> <span class="n">readr</span>   <span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">1</span>       <span class="err">✔</span> <span class="n">forcats</span> <span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">0</span>  
<span class="n">Warning</span> <span class="n">message</span><span class="p">:</span>
<span class="err">“</span><span class="n">package</span> <span class="err">‘</span><span class="n">tibble</span><span class="err">’</span> <span class="n">was</span> <span class="n">built</span> <span class="k">under</span> <span class="n">R</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">2</span><span class="err">”</span><span class="n">Warning</span> <span class="n">message</span><span class="p">:</span>
<span class="err">“</span><span class="n">package</span> <span class="err">‘</span><span class="n">purrr</span><span class="err">’</span> <span class="n">was</span> <span class="n">built</span> <span class="k">under</span> <span class="n">R</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">2</span><span class="err">”</span><span class="n">Warning</span> <span class="n">message</span><span class="p">:</span>
<span class="err">“</span><span class="n">package</span> <span class="err">‘</span><span class="n">dplyr</span><span class="err">’</span> <span class="n">was</span> <span class="n">built</span> <span class="k">under</span> <span class="n">R</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">2</span><span class="err">”</span><span class="n">Warning</span> <span class="n">message</span><span class="p">:</span>
<span class="err">“</span><span class="n">package</span> <span class="err">‘</span><span class="n">stringr</span><span class="err">’</span> <span class="n">was</span> <span class="n">built</span> <span class="k">under</span> <span class="n">R</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">2</span><span class="err">”</span><span class="n">Warning</span> <span class="n">message</span><span class="p">:</span>
<span class="err">“</span><span class="n">package</span> <span class="err">‘</span><span class="n">forcats</span><span class="err">’</span> <span class="n">was</span> <span class="n">built</span> <span class="k">under</span> <span class="n">R</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">2</span><span class="err">”──</span> <span class="n">Conflicts</span> <span class="err">──────────────────────────────────────────</span> <span class="n">tidyverse_conflicts</span><span class="p">()</span> <span class="err">──</span>
<span class="err">✖</span> <span class="n">dplyr</span><span class="p">::</span><span class="n">filter</span><span class="p">()</span> <span class="n">masks</span> <span class="n">stats</span><span class="p">::</span><span class="n">filter</span><span class="p">()</span>
<span class="err">✖</span> <span class="n">dplyr</span><span class="p">::</span><span class="n">lag</span><span class="p">()</span>    <span class="n">masks</span> <span class="n">stats</span><span class="p">::</span><span class="n">lag</span><span class="p">()</span>

<span class="n">Attaching</span> <span class="n">package</span><span class="p">:</span> <span class="err">‘</span><span class="n">gridExtra</span><span class="err">’</span>

<span class="n">The</span> <span class="n">following</span> <span class="k">object</span> <span class="k">is</span> <span class="n">masked</span> <span class="k">from</span> <span class="err">‘</span><span class="n">package</span><span class="p">:</span><span class="n">dplyr</span><span class="err">’</span><span class="p">:</span>

    <span class="n">combine</span>


<span class="n">Attaching</span> <span class="n">package</span><span class="p">:</span> <span class="err">‘</span><span class="n">maps</span><span class="err">’</span>

<span class="n">The</span> <span class="n">following</span> <span class="k">object</span> <span class="k">is</span> <span class="n">masked</span> <span class="k">from</span> <span class="err">‘</span><span class="n">package</span><span class="p">:</span><span class="n">purrr</span><span class="err">’</span><span class="p">:</span>

    <span class="k">map</span>
</pre></div>


<p>If you get an error message “there is no package called ‘xyz’” then you need to install the packages first. (They should have been preloaded on your notebooks but if not it's ok, it won't take long.)</p>
<div class="codehilite"><pre><span></span><span class="c1">#install.packages(&#39;tidyverse&#39;)</span>
<span class="c1">#install.packages(&#39;gridExtra&#39;)</span>
<span class="c1">#install.packages(&#39;ggrepel&#39;)</span>
<span class="c1">#install.packages(&#39;map&#39;)</span>
</pre></div>


<h1 id="visualizing-data">Visualizing Data</h1>
<p>Core feature of exploratory data analysis is asking questions about data and searching for answers by visualizing and modeling data. Most questions around what type of variation or covariation occurs between variables.</p>
<div class="codehilite"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">6</span><span class="p">,</span> <span class="n">repr.plot.height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="c1"># regular plot functions in R</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mpg</span><span class="o">$</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">mpg</span><span class="o">$</span><span class="n">hwy</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_5_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># ggplot!</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_6_0.png" /></p>
<p>Basic syntax of ggplot:</p>
<div class="codehilite"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="k">data</span><span class="o">=&lt;</span><span class="k">DATA</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+</span>
    <span class="o">&lt;</span><span class="n">GEOM_FUNCTION</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="n">aes</span><span class="p">(</span><span class="o">&lt;</span><span class="n">MAPPINGS</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Engine displacement (L)&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Heighway fuel economy (mpg)&quot;</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Fuel efficiency generally decreases with engine size&quot;</span><span class="p">,</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="s">&quot;Data from fueleconomy.gov&quot;</span><span class="p">,</span>
    <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&quot;Two seaters (sports cars) are an exception because of their light weight&quot;</span><span class="p">,</span>
    <span class="n">colour</span> <span class="o">=</span> <span class="s">&quot;Car type&quot;</span>
  <span class="p">)</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">`</span><span class="n">geom_smooth</span><span class="p">()</span><span class="o">`</span> <span class="k">using</span> <span class="k">method</span> <span class="o">=</span> <span class="s1">&#39;loess&#39;</span> <span class="k">and</span> <span class="n">formula</span> <span class="s1">&#39;y ~ x&#39;</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_8_1.png" /></p>
<h2 id="but-first">But first...</h2>
<div class="codehilite"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="k">data</span><span class="o">=&lt;</span><span class="k">DATA</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+</span>
    <span class="o">&lt;</span><span class="n">GEOM_FUNCTION</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="n">aes</span><span class="p">(</span><span class="o">&lt;</span><span class="n">MAPPINGS</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>


<p>How do we get data into a form appropriate for <strong>ggplot2</strong>?</p>
<h1 id="tidying-data">Tidying Data</h1>
<p>Most datasets are data frames made up of <strong>rows</strong> and <strong>columns</strong>. However, talking about data frames just in terms of what rows and columns it has is not enough.</p>
<ul>
<li><strong>Variable:</strong> quantity, quality, property that can be measured.</li>
<li><strong>Value:</strong> State of variable when measured.</li>
<li><strong>Observation:</strong> Set of measurements made under similar conditions</li>
<li><strong>Tabular data:</strong> Set of values, each associated with a variable and an observation.</li>
</ul>
<p>Tidy data:
 * Each variable is its own column
 * Each observation is its own row
 * Each value is in a single cell</p>
<p>Benefits:
 * Easy to manipulate
 * Easy to model
 * Easy to visualize
 * Has a specific and consistent structure
 * Stucture makes it easy to tidy other data</p>
<p>Cons:
 * Data frame is not as easy to look at</p>
<p>Consider the following tables:</p>
<div class="codehilite"><pre><span></span><span class="n">table1</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">makemodel</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;audi a4&quot;</span><span class="p">,</span><span class="s">&quot;audi a4&quot;</span><span class="p">,</span><span class="s">&quot;chevrolet corvette&quot;</span><span class="p">,</span><span class="s">&quot;chevrolet corvette&quot;</span><span class="p">,</span><span class="s">&quot;honda civic&quot;</span><span class="p">,</span><span class="s">&quot;honda civic&quot;</span><span class="p">),</span>
                    <span class="n">year</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1999</span><span class="p">,</span><span class="m">2008</span><span class="p">),</span><span class="m">3</span><span class="p">),</span>
                    <span class="n">cty</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">18</span><span class="p">,</span><span class="m">21</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">24</span><span class="p">,</span><span class="m">25</span><span class="p">),</span>
                    <span class="n">hwy</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">29</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">23</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="m">32</span><span class="p">,</span><span class="m">36</span><span class="p">))</span>
<span class="n">table1</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>year</th><th scope=col>cty</th><th scope=col>hwy</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>1999              </td><td>18                </td><td>29                </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>21                </td><td>30                </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>15                </td><td>23                </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>15                </td><td>25                </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>24                </td><td>32                </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>25                </td><td>36                </td></tr>
</tbody>
</table>

<p>This is tidy data, because each column is a variable, each observation is a row, and each value is in a single cell</p>
<p>Next we will look at some non-tidy data and operations from the <strong>tidyr</strong> package (part of <strong>tidyverse</strong>) to make the data tidy. Many of you might be more used to using operations from <strong>reshape2</strong> like melting and casting. It's a very useful package with more functionality including aggregating data, but syntax with <strong>tidyr</strong> commands is more simpler and intuitive for the purposes of tidying data.</p>
<h2 id="gathering">Gathering</h2>
<div class="codehilite"><pre><span></span><span class="n">table2a</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">makemodel</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;audi a4&quot;</span><span class="p">,</span><span class="s">&quot;chevrolet corvette&quot;</span><span class="p">,</span><span class="s">&quot;honda civic&quot;</span><span class="p">),</span><span class="n">`1999`</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">18</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">24</span><span class="p">),</span><span class="s">&#39;2008&#39;</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">21</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">25</span><span class="p">),</span><span class="n">check.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="n">table2b</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">makemodel</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;audi a4&quot;</span><span class="p">,</span><span class="s">&quot;chevrolet corvette&quot;</span><span class="p">,</span><span class="s">&quot;honda civic&quot;</span><span class="p">),</span><span class="n">`1999`</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">29</span><span class="p">,</span><span class="m">23</span><span class="p">,</span><span class="m">32</span><span class="p">),</span><span class="s">&#39;2008&#39;</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="m">36</span><span class="p">),</span><span class="n">check.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="n">table2a</span>
<span class="n">table2b</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>1999</th><th scope=col>2008</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>18                </td><td>21                </td></tr>
    <tr><td>chevrolet corvette</td><td>15                </td><td>15                </td></tr>
    <tr><td>honda civic       </td><td>24                </td><td>25                </td></tr>
</tbody>
</table>

<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>1999</th><th scope=col>2008</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>29                </td><td>30                </td></tr>
    <tr><td>chevrolet corvette</td><td>23                </td><td>25                </td></tr>
    <tr><td>honda civic       </td><td>32                </td><td>36                </td></tr>
</tbody>
</table>

<p><code>table2a</code> column names <code>1999</code> and <code>2008</code> represent values of <code>year</code> variable. <code>table2b</code> is the same. Each row represents 2 observations, not 1. Need to gather columns into new pair of variables.</p>
<p>Parameters:
 * Set of columns that represent values, not variables.
 * <code>key</code>: name of variable whose values are currently column names.
 * <code>value</code>: name of variable whose values are currently spread out across multiple columns.</p>
<p>Experiments often report data in the format of <code>table4a</code> and <code>table4b</code>. One reason is for presentation purposes it's very easy to look at. Another is storage is efficient for completely crossed designs and can allow matrix operations.</p>
<div class="codehilite"><pre><span></span><span class="n">tidy2a</span> <span class="o">&lt;-</span> <span class="nf">gather</span><span class="p">(</span><span class="n">table2a</span><span class="p">,</span><span class="n">`1999`</span><span class="p">,</span><span class="n">`2008`</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="s">&quot;year&quot;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&quot;cty&quot;</span><span class="p">)</span>
<span class="n">tidy2a</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>year</th><th scope=col>cty</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>1999              </td><td>18                </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>15                </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>24                </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>21                </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>15                </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>25                </td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="n">tidy2b</span> <span class="o">&lt;-</span> <span class="nf">gather</span><span class="p">(</span><span class="n">table2b</span><span class="p">,</span> <span class="n">`1999`</span><span class="p">,</span> <span class="n">`2008`</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s">&quot;year&quot;</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">&quot;hwy&quot;</span><span class="p">)</span>
<span class="n">tidy2b</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>year</th><th scope=col>hwy</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>1999              </td><td>29                </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>23                </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>32                </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>30                </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>25                </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>36                </td></tr>
</tbody>
</table>

<p>Merge tables using <code>left_join()</code> (many other types of <a href="https://dplyr.tidyverse.org/reference/join.html">table joins</a> as well)</p>
<div class="codehilite"><pre><span></span><span class="nf">left_join</span><span class="p">(</span><span class="n">tidy2a</span><span class="p">,</span><span class="n">tidy2b</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">Joining</span><span class="p">,</span> <span class="k">by</span> <span class="o">=</span> <span class="k">c</span><span class="p">(</span><span class="ss">&quot;makemodel&quot;</span><span class="p">,</span> <span class="ss">&quot;year&quot;</span><span class="p">)</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>year</th><th scope=col>cty</th><th scope=col>hwy</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>1999              </td><td>18                </td><td>29                </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>15                </td><td>23                </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>24                </td><td>32                </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>21                </td><td>30                </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>15                </td><td>25                </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>25                </td><td>36                </td></tr>
</tbody>
</table>

<h2 id="spreading">Spreading</h2>
<div class="codehilite"><pre><span></span><span class="n">table3</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">makemodel</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;audi a4&quot;</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;chevrolet corvette&quot;</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;honda civic&quot;</span><span class="p">,</span><span class="m">4</span><span class="p">)),</span>
                    <span class="n">year</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1999</span><span class="p">,</span><span class="m">1999</span><span class="p">,</span><span class="m">2008</span><span class="p">,</span><span class="m">2008</span><span class="p">),</span><span class="m">3</span><span class="p">),</span>
                    <span class="n">type</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;cty&quot;</span><span class="p">,</span><span class="s">&quot;hwy&quot;</span><span class="p">),</span><span class="m">6</span><span class="p">),</span>
                     <span class="n">mileage</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">18</span><span class="p">,</span><span class="m">29</span><span class="p">,</span><span class="m">21</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">23</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="m">24</span><span class="p">,</span><span class="m">32</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="m">36</span><span class="p">))</span>
<span class="n">table3</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>year</th><th scope=col>type</th><th scope=col>mileage</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>1999              </td><td>cty               </td><td>18                </td></tr>
    <tr><td>audi a4           </td><td>1999              </td><td>hwy               </td><td>29                </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>cty               </td><td>21                </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>hwy               </td><td>30                </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>cty               </td><td>15                </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>hwy               </td><td>23                </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>cty               </td><td>15                </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>hwy               </td><td>25                </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>cty               </td><td>24                </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>hwy               </td><td>32                </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>cty               </td><td>25                </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>hwy               </td><td>36                </td></tr>
</tbody>
</table>

<p><code>table3</code> has each observation in two rows. Need to spread observations across columns with appropriate variable names instead.</p>
<p>Parameters:
 * <code>key</code>: Column that contains variable names.
 * <code>value</code>: Column that contains values for each variable.</p>
<div class="codehilite"><pre><span></span><span class="nf">spread</span><span class="p">(</span><span class="n">table3</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">type</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">mileage</span><span class="p">)</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>year</th><th scope=col>cty</th><th scope=col>hwy</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>1999              </td><td>18                </td><td>29                </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>21                </td><td>30                </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>15                </td><td>23                </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>15                </td><td>25                </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>24                </td><td>32                </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>25                </td><td>36                </td></tr>
</tbody>
</table>

<h2 id="separating">Separating</h2>
<div class="codehilite"><pre><span></span><span class="n">table4</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">makemodel</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;audi a4&quot;</span><span class="p">,</span><span class="s">&quot;audi a4&quot;</span><span class="p">,</span><span class="s">&quot;chevrolet corvette&quot;</span><span class="p">,</span><span class="s">&quot;chevrolet corvette&quot;</span><span class="p">,</span><span class="s">&quot;honda civic&quot;</span><span class="p">,</span><span class="s">&quot;honda civic&quot;</span><span class="p">),</span>
                     <span class="n">year</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1999</span><span class="p">,</span><span class="m">2008</span><span class="p">),</span><span class="m">3</span><span class="p">),</span>
                    <span class="n">mileages</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;18/29&#39;</span><span class="p">,</span><span class="s">&#39;21/30&#39;</span><span class="p">,</span><span class="s">&#39;15/23&#39;</span><span class="p">,</span><span class="s">&#39;15/25&#39;</span><span class="p">,</span><span class="s">&#39;24/32&#39;</span><span class="p">,</span><span class="s">&#39;25/36&#39;</span><span class="p">))</span>
<span class="n">table4</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>year</th><th scope=col>mileages</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>1999              </td><td>18/29             </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>21/30             </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>15/23             </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>15/25             </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>24/32             </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>25/36             </td></tr>
</tbody>
</table>

<p><code>table4</code> has <code>mileages</code> column that actually contains two variables (<code>cty</code> and <code>hwy</code>). Need to separate into two columns.</p>
<p>Parameters:
 * column/variable that needs to be separated.
 * <code>into</code>: columns to split into
 * <code>sep</code>: separator value. Can be regexp or positions to split at. If not provided then splits at non-alphanumeric characters.</p>
<div class="codehilite"><pre><span></span><span class="nf">separate</span><span class="p">(</span><span class="n">table4</span><span class="p">,</span> <span class="n">mileages</span><span class="p">,</span> <span class="n">into</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;cty&quot;</span><span class="p">,</span> <span class="s">&quot;hwy&quot;</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>year</th><th scope=col>cty</th><th scope=col>hwy</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>1999              </td><td>18                </td><td>29                </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>21                </td><td>30                </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>15                </td><td>23                </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>15                </td><td>25                </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>24                </td><td>32                </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>25                </td><td>36                </td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="n">sep</span> <span class="o">&lt;-</span> <span class="nf">separate</span><span class="p">(</span><span class="n">table4</span><span class="p">,</span> <span class="n">makemodel</span><span class="p">,</span> <span class="n">into</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;model&quot;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="p">)</span>
<span class="n">sep</span>
</pre></div>


<table>
<thead><tr><th scope=col>make</th><th scope=col>model</th><th scope=col>year</th><th scope=col>mileages</th></tr></thead>
<tbody>
    <tr><td>audi     </td><td>a4       </td><td>1999     </td><td>18/29    </td></tr>
    <tr><td>audi     </td><td>a4       </td><td>2008     </td><td>21/30    </td></tr>
    <tr><td>chevrolet</td><td>corvette </td><td>1999     </td><td>15/23    </td></tr>
    <tr><td>chevrolet</td><td>corvette </td><td>2008     </td><td>15/25    </td></tr>
    <tr><td>honda    </td><td>civic    </td><td>1999     </td><td>24/32    </td></tr>
    <tr><td>honda    </td><td>civic    </td><td>2008     </td><td>25/36    </td></tr>
</tbody>
</table>

<h2 id="uniting">Uniting</h2>
<p>Now <code>sep</code> has <code>make</code> and <code>model</code> columns that can be combined into a single column. In other words, we want to unite them.</p>
<p>Parameters:
 * Name of united column/variable
 * Names of columns/variables to be united
 * <code>sep</code>: Separator value. Default is '_'</p>
<div class="codehilite"><pre><span></span><span class="nf">unite</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>


<table>
<thead><tr><th scope=col>new</th><th scope=col>year</th><th scope=col>mileages</th></tr></thead>
<tbody>
    <tr><td>audi_a4           </td><td>1999              </td><td>18/29             </td></tr>
    <tr><td>audi_a4           </td><td>2008              </td><td>21/30             </td></tr>
    <tr><td>chevrolet_corvette</td><td>1999              </td><td>15/23             </td></tr>
    <tr><td>chevrolet_corvette</td><td>2008              </td><td>15/25             </td></tr>
    <tr><td>honda_civic       </td><td>1999              </td><td>24/32             </td></tr>
    <tr><td>honda_civic       </td><td>2008              </td><td>25/36             </td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="nf">unite</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">makemodel</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">)</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>year</th><th scope=col>mileages</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>1999              </td><td>18/29             </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>21/30             </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>15/23             </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>15/25             </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>24/32             </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>25/36             </td></tr>
</tbody>
</table>

<h2 id="piping">Piping</h2>
<p><strong>dplyr</strong> from <strong>tidyverse</strong> contains the 'pipe' (<code>%&gt;%</code>) which allows you to combine multiple operations, directly taking output from a funtion as input to the next. Can save time and memory as well as make code easier to read. Can think of it this way: <code>x %&gt;% f(y)</code> becomes <code>f(x,y)</code>, and <code>x %&gt;% f(y) %&gt;% g(z)</code> becomes <code>g(f(x,y),z)</code>, etc.</p>
<div class="codehilite"><pre><span></span><span class="nf">unite</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">makemodel</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">separate</span><span class="p">(</span><span class="n">mileages</span><span class="p">,</span> <span class="n">into</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;cty&quot;</span><span class="p">,</span><span class="s">&quot;hwy&quot;</span><span class="p">))</span>
</pre></div>


<table>
<thead><tr><th scope=col>makemodel</th><th scope=col>year</th><th scope=col>cty</th><th scope=col>hwy</th></tr></thead>
<tbody>
    <tr><td>audi a4           </td><td>1999              </td><td>18                </td><td>29                </td></tr>
    <tr><td>audi a4           </td><td>2008              </td><td>21                </td><td>30                </td></tr>
    <tr><td>chevrolet corvette</td><td>1999              </td><td>15                </td><td>23                </td></tr>
    <tr><td>chevrolet corvette</td><td>2008              </td><td>15                </td><td>25                </td></tr>
    <tr><td>honda civic       </td><td>1999              </td><td>24                </td><td>32                </td></tr>
    <tr><td>honda civic       </td><td>2008              </td><td>25                </td><td>36                </td></tr>
</tbody>
</table>

<h2 id="not-all-data-should-be-tidy">Not all data should be tidy</h2>
<p>Matrices, phylogenetic trees (although <code>ggtree</code> and <code>treeio</code> have tidy representations that help with annotating trees), etc.</p>
<h1 id="transforming-tidy-data">Transforming (Tidy) Data</h1>
<p>Now we know how to get tidy data. At this point we can already start visualizing our data. However in many cases we will need to further transform our data to narrow down variables and observations we are really interested in or to create new variables that are functions of our existing variables and data. This is known as <strong>transforming</strong> data.</p>
<ul>
<li><code>filter()</code> to pick observations (rows) by their values</li>
<li><code>arrange()</code> to reorder rows, default is by ascending value</li>
<li><code>select()</code> to pick variables (columns) by their names</li>
<li><code>mutate()</code> to create new variables with functions of existing variables</li>
<li><code>summarise()</code> to collapes many values down to a single summary</li>
<li><code>group_by()</code> to set up functions to operate on groups rather than the whole data set</li>
<li><code>%&gt;%</code> propagates the output from a function as input to another. eg: x %&gt;% f(y) becomes f(x,y), and x %&gt;% f(y) %&gt;% g(z) becomes g(f(x,y),z).</li>
</ul>
<p>All functions have similar structure:
 1. First argument is data frame
 2. Next arguments describe what to do with data frame using variable names
 3. Result is new data frame</p>
<p>Will be working with data frame <strong>mpg</strong> for rest of workshop which comes with the <strong>tidyverse</strong> library.</p>
<div class="codehilite"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cyl</th><th scope=col>trans</th><th scope=col>drv</th><th scope=col>cty</th><th scope=col>hwy</th><th scope=col>fl</th><th scope=col>class</th></tr></thead>
<tbody>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>auto(l5)  </td><td>f         </td><td>18        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>manual(m5)</td><td>f         </td><td>21        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>manual(m6)</td><td>f         </td><td>20        </td><td>31        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>auto(av)  </td><td>f         </td><td>21        </td><td>30        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>auto(l5)  </td><td>f         </td><td>16        </td><td>26        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>manual(m5)</td><td>f         </td><td>18        </td><td>26        </td><td>p         </td><td>compact   </td></tr>
</tbody>
</table>

<h2 id="filter-rowsobservations"><code>filter()</code> rows/observations</h2>
<p>As name suggests filters out rows. First argument is name of data frame, next arguments are expressions that filter the data frame.</p>
<div class="codehilite"><pre><span></span><span class="c1"># filter out 2seater cars</span>
<span class="n">no_2seaters</span> <span class="o">&lt;-</span> <span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">class</span> <span class="o">!=</span> <span class="s">&quot;2seater&quot;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">no_2seaters</span><span class="p">)</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cyl</th><th scope=col>trans</th><th scope=col>drv</th><th scope=col>cty</th><th scope=col>hwy</th><th scope=col>fl</th><th scope=col>class</th></tr></thead>
<tbody>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>auto(l5)  </td><td>f         </td><td>18        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>manual(m5)</td><td>f         </td><td>21        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>manual(m6)</td><td>f         </td><td>20        </td><td>31        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>auto(av)  </td><td>f         </td><td>21        </td><td>30        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>auto(l5)  </td><td>f         </td><td>16        </td><td>26        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>manual(m5)</td><td>f         </td><td>18        </td><td>26        </td><td>p         </td><td>compact   </td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="c1"># filter out audis, chevys, and hondas</span>
<span class="n">mpg</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="n">manufacturer</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;audi&quot;</span><span class="p">,</span><span class="s">&quot;chevrolet&quot;</span><span class="p">,</span><span class="s">&quot;honda&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cyl</th><th scope=col>trans</th><th scope=col>drv</th><th scope=col>cty</th><th scope=col>hwy</th><th scope=col>fl</th><th scope=col>class</th></tr></thead>
<tbody>
    <tr><td>dodge      </td><td>caravan 2wd</td><td>2.4        </td><td>1999       </td><td>4          </td><td>auto(l3)   </td><td>f          </td><td>18         </td><td>24         </td><td>r          </td><td>minivan    </td></tr>
    <tr><td>dodge      </td><td>caravan 2wd</td><td>3.0        </td><td>1999       </td><td>6          </td><td>auto(l4)   </td><td>f          </td><td>17         </td><td>24         </td><td>r          </td><td>minivan    </td></tr>
    <tr><td>dodge      </td><td>caravan 2wd</td><td>3.3        </td><td>1999       </td><td>6          </td><td>auto(l4)   </td><td>f          </td><td>16         </td><td>22         </td><td>r          </td><td>minivan    </td></tr>
    <tr><td>dodge      </td><td>caravan 2wd</td><td>3.3        </td><td>1999       </td><td>6          </td><td>auto(l4)   </td><td>f          </td><td>16         </td><td>22         </td><td>r          </td><td>minivan    </td></tr>
    <tr><td>dodge      </td><td>caravan 2wd</td><td>3.3        </td><td>2008       </td><td>6          </td><td>auto(l4)   </td><td>f          </td><td>17         </td><td>24         </td><td>r          </td><td>minivan    </td></tr>
    <tr><td>dodge      </td><td>caravan 2wd</td><td>3.3        </td><td>2008       </td><td>6          </td><td>auto(l4)   </td><td>f          </td><td>17         </td><td>24         </td><td>r          </td><td>minivan    </td></tr>
</tbody>
</table>

<h2 id="arrange-rowsobservations"><code>arrange()</code> rows/observations</h2>
<p>Changes order of rows. First argument is name of data frame, next arguments are column names (or more complicated expressions) to order by. Default column ordering is by ascending order, can use <code>desc()</code> to do descending order. Missing values get sorted at the end regardless of what column ordering is chosen.</p>
<div class="codehilite"><pre><span></span><span class="c1"># arrange/reorder mpg by class</span>
<span class="nf">arrange</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">class</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cyl</th><th scope=col>trans</th><th scope=col>drv</th><th scope=col>cty</th><th scope=col>hwy</th><th scope=col>fl</th><th scope=col>class</th></tr></thead>
<tbody>
    <tr><td>chevrolet </td><td>corvette  </td><td>5.7       </td><td>1999      </td><td>8         </td><td>manual(m6)</td><td>r         </td><td>16        </td><td>26        </td><td>p         </td><td>2seater   </td></tr>
    <tr><td>chevrolet </td><td>corvette  </td><td>5.7       </td><td>1999      </td><td>8         </td><td>auto(l4)  </td><td>r         </td><td>15        </td><td>23        </td><td>p         </td><td>2seater   </td></tr>
    <tr><td>chevrolet </td><td>corvette  </td><td>6.2       </td><td>2008      </td><td>8         </td><td>manual(m6)</td><td>r         </td><td>16        </td><td>26        </td><td>p         </td><td>2seater   </td></tr>
    <tr><td>chevrolet </td><td>corvette  </td><td>6.2       </td><td>2008      </td><td>8         </td><td>auto(s6)  </td><td>r         </td><td>15        </td><td>25        </td><td>p         </td><td>2seater   </td></tr>
    <tr><td>chevrolet </td><td>corvette  </td><td>7.0       </td><td>2008      </td><td>8         </td><td>manual(m6)</td><td>r         </td><td>15        </td><td>24        </td><td>p         </td><td>2seater   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>auto(l5)  </td><td>f         </td><td>18        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="c1"># arrange/reorder data frame with 2seaters filtered out by class</span>
<span class="c1"># 2seaters does not appear which is as it should be</span>
<span class="nf">arrange</span><span class="p">(</span><span class="n">no_2seaters</span><span class="p">,</span> <span class="n">class</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cyl</th><th scope=col>trans</th><th scope=col>drv</th><th scope=col>cty</th><th scope=col>hwy</th><th scope=col>fl</th><th scope=col>class</th></tr></thead>
<tbody>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>auto(l5)  </td><td>f         </td><td>18        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>manual(m5)</td><td>f         </td><td>21        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>manual(m6)</td><td>f         </td><td>20        </td><td>31        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>auto(av)  </td><td>f         </td><td>21        </td><td>30        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>auto(l5)  </td><td>f         </td><td>16        </td><td>26        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>manual(m5)</td><td>f         </td><td>18        </td><td>26        </td><td>p         </td><td>compact   </td></tr>
</tbody>
</table>

<p>What kinds of cars have the best highway and city gas mileage?</p>
<div class="codehilite"><pre><span></span><span class="c1"># arrange mpg so that first hwy mileage is by descending order, then cty mileage is by descending order</span>
<span class="nf">arrange</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">desc</span><span class="p">(</span><span class="n">hwy</span><span class="p">),</span> <span class="nf">desc</span><span class="p">(</span><span class="n">cty</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cyl</th><th scope=col>trans</th><th scope=col>drv</th><th scope=col>cty</th><th scope=col>hwy</th><th scope=col>fl</th><th scope=col>class</th></tr></thead>
<tbody>
    <tr><td>volkswagen</td><td>new beetle</td><td>1.9       </td><td>1999      </td><td>4         </td><td>manual(m5)</td><td>f         </td><td>35        </td><td>44        </td><td>d         </td><td>subcompact</td></tr>
    <tr><td>volkswagen</td><td>jetta     </td><td>1.9       </td><td>1999      </td><td>4         </td><td>manual(m5)</td><td>f         </td><td>33        </td><td>44        </td><td>d         </td><td>compact   </td></tr>
    <tr><td>volkswagen</td><td>new beetle</td><td>1.9       </td><td>1999      </td><td>4         </td><td>auto(l4)  </td><td>f         </td><td>29        </td><td>41        </td><td>d         </td><td>subcompact</td></tr>
    <tr><td>toyota    </td><td>corolla   </td><td>1.8       </td><td>2008      </td><td>4         </td><td>manual(m5)</td><td>f         </td><td>28        </td><td>37        </td><td>r         </td><td>compact   </td></tr>
    <tr><td>honda     </td><td>civic     </td><td>1.8       </td><td>2008      </td><td>4         </td><td>auto(l5)  </td><td>f         </td><td>25        </td><td>36        </td><td>r         </td><td>subcompact</td></tr>
    <tr><td>honda     </td><td>civic     </td><td>1.8       </td><td>2008      </td><td>4         </td><td>auto(l5)  </td><td>f         </td><td>24        </td><td>36        </td><td>c         </td><td>subcompact</td></tr>
</tbody>
</table>

<p>Example of missing data getting placed at bottom.</p>
<div class="codehilite"><pre><span></span><span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="m">6</span><span class="p">))</span>
<span class="n">df</span>
</pre></div>


<table>
<thead><tr><th scope=col>x</th></tr></thead>
<tbody>
    <tr><td> 5</td></tr>
    <tr><td> 2</td></tr>
    <tr><td>NA</td></tr>
    <tr><td> 6</td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="c1"># arrange df by ascending order, NA will be at bottom</span>
<span class="nf">arrange</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>


<table>
<thead><tr><th scope=col>x</th></tr></thead>
<tbody>
    <tr><td> 2</td></tr>
    <tr><td> 5</td></tr>
    <tr><td> 6</td></tr>
    <tr><td>NA</td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="c1"># arrange df by descending order, NA will be at bottom</span>
<span class="nf">arrange</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">desc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>


<table>
<thead><tr><th scope=col>x</th></tr></thead>
<tbody>
    <tr><td> 6</td></tr>
    <tr><td> 5</td></tr>
    <tr><td> 2</td></tr>
    <tr><td>NA</td></tr>
</tbody>
</table>

<p>If you want to bring <code>NA</code> to the top, you can instead use <code>!is.na(x)</code> which evaluates as a boolean, so FALSE/TRUE. The df gets arranged by FALSE first, so NA goes to the top. However the rest of the values are unsorted since they will all return TRUE, although you can add more arguments to sort by the same column. This can be done for any other variable you want to use to rearrange with boolean expressions instead.</p>
<div class="codehilite"><pre><span></span><span class="c1"># rest of the values are unsorted because they are all T for !is.na(x)</span>
<span class="nf">arrange</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>


<table>
<thead><tr><th scope=col>x</th></tr></thead>
<tbody>
    <tr><td>NA</td></tr>
    <tr><td> 5</td></tr>
    <tr><td> 2</td></tr>
    <tr><td> 6</td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="c1"># can arrange by x again to get ascending order</span>
<span class="nf">arrange</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">x</span><span class="p">)</span>
</pre></div>


<table>
<thead><tr><th scope=col>x</th></tr></thead>
<tbody>
    <tr><td>NA</td></tr>
    <tr><td> 2</td></tr>
    <tr><td> 5</td></tr>
    <tr><td> 6</td></tr>
</tbody>
</table>

<h2 id="select-columnsvariables"><code>select()</code> columns/variables</h2>
<p>Selects columns, which can be useful when you have hundreds or thousands of variables in order to narrow down to what variables you're actually interested in. First argument is name of data frame, subsequent arguments are columns to select. Can use <code>a:b</code> to select all columns between <code>a</code> and <code>b</code>, or use <code>-a</code> to select all columns <em>except</em> a.</p>
<div class="codehilite"><pre><span></span><span class="c1"># select manufacturer, model, year, cty, hwy</span>
<span class="nf">select</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">cty</span><span class="p">,</span> <span class="n">hwy</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>year</th><th scope=col>cty</th><th scope=col>hwy</th></tr></thead>
<tbody>
    <tr><td>audi</td><td>a4  </td><td>1999</td><td>18  </td><td>29  </td></tr>
    <tr><td>audi</td><td>a4  </td><td>1999</td><td>21  </td><td>29  </td></tr>
    <tr><td>audi</td><td>a4  </td><td>2008</td><td>20  </td><td>31  </td></tr>
    <tr><td>audi</td><td>a4  </td><td>2008</td><td>21  </td><td>30  </td></tr>
    <tr><td>audi</td><td>a4  </td><td>1999</td><td>16  </td><td>26  </td></tr>
    <tr><td>audi</td><td>a4  </td><td>1999</td><td>18  </td><td>26  </td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="c1"># select all columns model thru hwy</span>
<span class="nf">select</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">model</span><span class="o">:</span><span class="n">hwy</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>


<table>
<thead><tr><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cyl</th><th scope=col>trans</th><th scope=col>drv</th><th scope=col>cty</th><th scope=col>hwy</th></tr></thead>
<tbody>
    <tr><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>auto(l5)  </td><td>f         </td><td>18        </td><td>29        </td></tr>
    <tr><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>manual(m5)</td><td>f         </td><td>21        </td><td>29        </td></tr>
    <tr><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>manual(m6)</td><td>f         </td><td>20        </td><td>31        </td></tr>
    <tr><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>auto(av)  </td><td>f         </td><td>21        </td><td>30        </td></tr>
    <tr><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>auto(l5)  </td><td>f         </td><td>16        </td><td>26        </td></tr>
    <tr><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>manual(m5)</td><td>f         </td><td>18        </td><td>26        </td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="c1"># select all columns except cyl thru drv and class</span>
<span class="nf">select</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">cyl</span><span class="o">:</span><span class="n">drv</span><span class="p">),</span> <span class="o">-</span><span class="n">class</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cty</th><th scope=col>hwy</th><th scope=col>fl</th></tr></thead>
<tbody>
    <tr><td>audi</td><td>a4  </td><td>1.8 </td><td>1999</td><td>18  </td><td>29  </td><td>p   </td></tr>
    <tr><td>audi</td><td>a4  </td><td>1.8 </td><td>1999</td><td>21  </td><td>29  </td><td>p   </td></tr>
    <tr><td>audi</td><td>a4  </td><td>2.0 </td><td>2008</td><td>20  </td><td>31  </td><td>p   </td></tr>
    <tr><td>audi</td><td>a4  </td><td>2.0 </td><td>2008</td><td>21  </td><td>30  </td><td>p   </td></tr>
    <tr><td>audi</td><td>a4  </td><td>2.8 </td><td>1999</td><td>16  </td><td>26  </td><td>p   </td></tr>
    <tr><td>audi</td><td>a4  </td><td>2.8 </td><td>1999</td><td>18  </td><td>26  </td><td>p   </td></tr>
</tbody>
</table>

<h2 id="mutate-to-add-new-variables-or-transmute-to-keep-only-new-variables"><code>mutate()</code> to add new variables or <code>transmute()</code> to keep only new variables</h2>
<p>Adds new columns that are functions of existing columns. First argument is name of data frame, next arguments are of the form <code>new_column_name = f(existing columns)</code>.</p>
<div class="codehilite"><pre><span></span><span class="c1"># add a new column that takes average mileage between city and highway</span>
<span class="nf">mutate</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">avg_mileage</span> <span class="o">=</span> <span class="p">(</span><span class="n">cty</span><span class="o">+</span><span class="n">hwy</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cyl</th><th scope=col>trans</th><th scope=col>drv</th><th scope=col>cty</th><th scope=col>hwy</th><th scope=col>fl</th><th scope=col>class</th><th scope=col>avg_mileage</th></tr></thead>
<tbody>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>auto(l5)  </td><td>f         </td><td>18        </td><td>29        </td><td>p         </td><td>compact   </td><td>23.5      </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>manual(m5)</td><td>f         </td><td>21        </td><td>29        </td><td>p         </td><td>compact   </td><td>25.0      </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>manual(m6)</td><td>f         </td><td>20        </td><td>31        </td><td>p         </td><td>compact   </td><td>25.5      </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>auto(av)  </td><td>f         </td><td>21        </td><td>30        </td><td>p         </td><td>compact   </td><td>25.5      </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>auto(l5)  </td><td>f         </td><td>16        </td><td>26        </td><td>p         </td><td>compact   </td><td>21.0      </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>manual(m5)</td><td>f         </td><td>18        </td><td>26        </td><td>p         </td><td>compact   </td><td>22.0      </td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="c1"># keep only average mileage between city and highway</span>
<span class="nf">transmute</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="n">avg_mileage</span><span class="o">=</span><span class="p">(</span><span class="n">cty</span><span class="o">+</span><span class="n">hwy</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>


<table>
<thead><tr><th scope=col>avg_mileage</th></tr></thead>
<tbody>
    <tr><td>23.5</td></tr>
    <tr><td>25.0</td></tr>
    <tr><td>25.5</td></tr>
    <tr><td>25.5</td></tr>
    <tr><td>21.0</td></tr>
    <tr><td>22.0</td></tr>
</tbody>
</table>

<h2 id="summarise-and-group_by-for-grouped-summaries"><code>summarise()</code> and <code>group_by()</code> for grouped summaries</h2>
<p><code>summarise()</code> collapses a data frame into a single row, and <code>group_by()</code> changes analysis from entire data frame into individual groups.</p>
<div class="codehilite"><pre><span></span><span class="c1"># get average mileage grouped by engine cylinder</span>
<span class="n">m</span> <span class="o">&lt;-</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">avg_mileage</span><span class="o">=</span><span class="p">(</span><span class="n">cty</span><span class="o">+</span><span class="n">hwy</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">)</span>
<span class="c1"># behavior is actually different in R/RStudio compared to notebooks</span>
<span class="n">m</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarise</span><span class="p">(</span><span class="n">avg</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">avg_mileage</span><span class="p">))</span> <span class="o">%&gt;%</span>
    <span class="n">head</span>
</pre></div>


<table>
<thead><tr><th scope=col>cyl</th><th scope=col>avg</th></tr></thead>
<tbody>
    <tr><td>4       </td><td>24.90741</td></tr>
    <tr><td>5       </td><td>24.62500</td></tr>
    <tr><td>6       </td><td>19.51899</td></tr>
    <tr><td>8       </td><td>15.10000</td></tr>
</tbody>
</table>

<p><strong>Note:</strong> If you look at the output of <code>group_by</code> in R/RStudio you will actually be able to see what your groupings are as well as how many of them you have. For example if we did <code>group_by(mpg, cyl)</code> the output would include <code>cyl [4]</code> which shows that our grouping is by <code>cyl</code> and there are 4 groups. Jupyter notebook doesn't display this for reasons having to do with <a href="https://github.com/IRkernel/repr/issues/113">how data frames are outputted</a>. Some other differences exist between how certain objects from <strong>tidyverse</strong> are displayed as well.</p>
<div class="codehilite"><pre><span></span><span class="nf">group_by</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">drv</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarise</span><span class="p">(</span><span class="n">avg</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">avg_mileage</span><span class="p">))</span>
</pre></div>


<table>
<thead><tr><th scope=col>drv</th><th scope=col>avg</th></tr></thead>
<tbody>
    <tr><td>4       </td><td>16.75243</td></tr>
    <tr><td>f       </td><td>24.06604</td></tr>
    <tr><td>r       </td><td>17.54000</td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="c1"># df after group_by would show that we have 9 groups</span>
<span class="n">drv_cyl</span> <span class="o">&lt;-</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">drv</span><span class="p">,</span> <span class="n">cyl</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarise</span><span class="p">(</span><span class="n">avg</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">avg_mileage</span><span class="p">))</span> <span class="o">%&gt;%</span>
    <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">avg</span><span class="p">))</span>
<span class="n">drv_cyl</span>
</pre></div>


<table>
<thead><tr><th scope=col>drv</th><th scope=col>cyl</th><th scope=col>avg</th></tr></thead>
<tbody>
    <tr><td>f       </td><td>4       </td><td>26.26724</td></tr>
    <tr><td>f       </td><td>5       </td><td>24.62500</td></tr>
    <tr><td>4       </td><td>4       </td><td>21.47826</td></tr>
    <tr><td>r       </td><td>6       </td><td>21.25000</td></tr>
    <tr><td>f       </td><td>6       </td><td>21.12791</td></tr>
    <tr><td>f       </td><td>8       </td><td>20.50000</td></tr>
    <tr><td>4       </td><td>6       </td><td>17.14062</td></tr>
    <tr><td>r       </td><td>8       </td><td>16.83333</td></tr>
    <tr><td>4       </td><td>8       </td><td>14.22917</td></tr>
</tbody>
</table>

<p>Can also run <code>ungroup</code> to ungroup your observations.</p>
<div class="codehilite"><pre><span></span><span class="n">drv_cyl</span> <span class="o">%&gt;%</span> <span class="nf">summarise</span><span class="p">(</span><span class="n">max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">avg</span><span class="p">))</span>
</pre></div>


<table>
<thead><tr><th scope=col>drv</th><th scope=col>max</th></tr></thead>
<tbody>
    <tr><td>4       </td><td>21.47826</td></tr>
    <tr><td>f       </td><td>26.26724</td></tr>
    <tr><td>r       </td><td>21.25000</td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="nf">ungroup</span><span class="p">(</span><span class="n">drv_cyl</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarise</span><span class="p">(</span><span class="n">max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">avg</span><span class="p">))</span>
</pre></div>


<table>
<thead><tr><th scope=col>max</th></tr></thead>
<tbody>
    <tr><td>26.26724</td></tr>
</tbody>
</table>

<h1 id="back-to-visualizing-data">Back to Visualizing Data</h1>
<p>Basic syntax of ggplot:</p>
<div class="codehilite"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="k">data</span><span class="o">=&lt;</span><span class="k">DATA</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+</span>
    <span class="o">&lt;</span><span class="n">GEOM_FUNCTION</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="n">aes</span><span class="p">(</span><span class="o">&lt;</span><span class="n">MAPPINGS</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="c1"># automatically loaded when you load tidyverse</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cyl</th><th scope=col>trans</th><th scope=col>drv</th><th scope=col>cty</th><th scope=col>hwy</th><th scope=col>fl</th><th scope=col>class</th></tr></thead>
<tbody>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>auto(l5)  </td><td>f         </td><td>18        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>manual(m5)</td><td>f         </td><td>21        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>manual(m6)</td><td>f         </td><td>20        </td><td>31        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>auto(av)  </td><td>f         </td><td>21        </td><td>30        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>auto(l5)  </td><td>f         </td><td>16        </td><td>26        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>manual(m5)</td><td>f         </td><td>18        </td><td>26        </td><td>p         </td><td>compact   </td></tr>
</tbody>
</table>

<p>Let's break down the components of ggplot. First, note that <code>ggplot(data=&lt;DATA&gt;)</code> on its own will not actually plot anything.</p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_70_0.png" /></p>
<p>This is because we need the <code>&lt;GEOM_FUNCTION&gt;(mapping=aes(&lt;MAPPINGS&gt;)</code> to tell us what exactly to plot using our data. However, just <code>ggplot(data=&lt;DATA&gt;) + &lt;GEOM_FUNCTION&gt;()</code> on its own doesn't do anything either.</p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nv">ERROR</span> <span class="k">while</span> <span class="nv">rich</span> <span class="nv">displaying</span> <span class="nv">an</span> <span class="nv">object</span>: <span class="nv">Error</span>: <span class="nv">geom_point</span> <span class="nv">requires</span> <span class="nv">the</span> <span class="nv">following</span> <span class="nv">missing</span> <span class="nv">aesthetics</span>: <span class="nv">x</span>, <span class="nv">y</span>

<span class="nv">Traceback</span>:
<span class="mi">1</span>. <span class="nv">FUN</span><span class="ss">(</span><span class="nv">X</span>[[<span class="nv">i</span>]], ...<span class="ss">)</span>
<span class="mi">2</span>. <span class="nv">tryCatch</span><span class="ss">(</span><span class="nv">withCallingHandlers</span><span class="ss">(</span>{
 .     <span class="k">if</span> <span class="ss">(</span><span class="o">!</span><span class="nv">mime</span> <span class="o">%</span><span class="nv">in</span><span class="o">%</span> <span class="nv">names</span><span class="ss">(</span><span class="nv">repr</span>::<span class="nv">mime2repr</span><span class="ss">))</span> 
 .         <span class="nv">stop</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">No repr_* for mimetype </span><span class="s2">&quot;</span>, <span class="nv">mime</span>, <span class="s2">&quot;</span><span class="s"> in repr::mime2repr</span><span class="s2">&quot;</span><span class="ss">)</span>
 .     <span class="nv">rpr</span> <span class="o">&lt;-</span> <span class="nv">repr</span>::<span class="nv">mime2repr</span>[[<span class="nv">mime</span>]]<span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
 .     <span class="k">if</span> <span class="ss">(</span><span class="nv">is</span>.<span class="nv">null</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">))</span> 
 .         <span class="k">return</span><span class="ss">(</span><span class="nv">NULL</span><span class="ss">)</span>
 .     <span class="nv">prepare_content</span><span class="ss">(</span><span class="nv">is</span>.<span class="nv">raw</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">)</span>, <span class="nv">rpr</span><span class="ss">)</span>
 . }, <span class="nv">error</span> <span class="o">=</span> <span class="nv">error_handler</span><span class="ss">)</span>, <span class="nv">error</span> <span class="o">=</span> <span class="nv">outer_handler</span><span class="ss">)</span>
<span class="mi">3</span>. <span class="nv">tryCatchList</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">classes</span>, <span class="nv">parentenv</span>, <span class="nv">handlers</span><span class="ss">)</span>
<span class="mi">4</span>. <span class="nv">tryCatchOne</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">names</span>, <span class="nv">parentenv</span>, <span class="nv">handlers</span>[[<span class="mi">1</span><span class="nv">L</span>]]<span class="ss">)</span>
<span class="mi">5</span>. <span class="nv">doTryCatch</span><span class="ss">(</span><span class="k">return</span><span class="ss">(</span><span class="nv">expr</span><span class="ss">)</span>, <span class="nv">name</span>, <span class="nv">parentenv</span>, <span class="nv">handler</span><span class="ss">)</span>
<span class="mi">6</span>. <span class="nv">withCallingHandlers</span><span class="ss">(</span>{
 .     <span class="k">if</span> <span class="ss">(</span><span class="o">!</span><span class="nv">mime</span> <span class="o">%</span><span class="nv">in</span><span class="o">%</span> <span class="nv">names</span><span class="ss">(</span><span class="nv">repr</span>::<span class="nv">mime2repr</span><span class="ss">))</span> 
 .         <span class="nv">stop</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">No repr_* for mimetype </span><span class="s2">&quot;</span>, <span class="nv">mime</span>, <span class="s2">&quot;</span><span class="s"> in repr::mime2repr</span><span class="s2">&quot;</span><span class="ss">)</span>
 .     <span class="nv">rpr</span> <span class="o">&lt;-</span> <span class="nv">repr</span>::<span class="nv">mime2repr</span>[[<span class="nv">mime</span>]]<span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
 .     <span class="k">if</span> <span class="ss">(</span><span class="nv">is</span>.<span class="nv">null</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">))</span> 
 .         <span class="k">return</span><span class="ss">(</span><span class="nv">NULL</span><span class="ss">)</span>
 .     <span class="nv">prepare_content</span><span class="ss">(</span><span class="nv">is</span>.<span class="nv">raw</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">)</span>, <span class="nv">rpr</span><span class="ss">)</span>
 . }, <span class="nv">error</span> <span class="o">=</span> <span class="nv">error_handler</span><span class="ss">)</span>
<span class="mi">7</span>. <span class="nv">repr</span>::<span class="nv">mime2repr</span>[[<span class="nv">mime</span>]]<span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">8</span>. <span class="nv">repr_text</span>.<span class="nv">default</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">9</span>. <span class="nv">paste</span><span class="ss">(</span><span class="nv">capture</span>.<span class="nv">output</span><span class="ss">(</span><span class="nv">print</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">))</span>, <span class="nv">collapse</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="ss">)</span>
<span class="mi">10</span>. <span class="nv">capture</span>.<span class="nv">output</span><span class="ss">(</span><span class="nv">print</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">))</span>
<span class="mi">11</span>. <span class="nv">evalVis</span><span class="ss">(</span><span class="nv">expr</span><span class="ss">)</span>
<span class="mi">12</span>. <span class="nv">withVisible</span><span class="ss">(</span><span class="nv">eval</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">pf</span><span class="ss">))</span>
<span class="mi">13</span>. <span class="nv">eval</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">pf</span><span class="ss">)</span>
<span class="mi">14</span>. <span class="nv">eval</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">pf</span><span class="ss">)</span>
<span class="mi">15</span>. <span class="nv">print</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">16</span>. <span class="nv">print</span>.<span class="nv">ggplot</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">17</span>. <span class="nv">ggplot_build</span><span class="ss">(</span><span class="nv">x</span><span class="ss">)</span>
<span class="mi">18</span>. <span class="nv">ggplot_build</span>.<span class="nv">ggplot</span><span class="ss">(</span><span class="nv">x</span><span class="ss">)</span>
<span class="mi">19</span>. <span class="nv">by_layer</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nv">l</span>, <span class="nv">d</span><span class="ss">)</span> <span class="nv">l</span><span class="mh">$c</span><span class="nv">ompute_geom_1</span><span class="ss">(</span><span class="nv">d</span><span class="ss">))</span>
<span class="mi">20</span>. <span class="nv">f</span><span class="ss">(</span><span class="nv">l</span> <span class="o">=</span> <span class="nv">layers</span>[[<span class="nv">i</span>]], <span class="nv">d</span> <span class="o">=</span> <span class="nv">data</span>[[<span class="nv">i</span>]]<span class="ss">)</span>
<span class="mi">21</span>. <span class="nv">l</span><span class="mh">$c</span><span class="nv">ompute_geom_1</span><span class="ss">(</span><span class="nv">d</span><span class="ss">)</span>
<span class="mi">22</span>. <span class="nv">f</span><span class="ss">(</span>..., <span class="nv">self</span> <span class="o">=</span> <span class="nv">self</span><span class="ss">)</span>
<span class="mi">23</span>. <span class="nv">check_required_aesthetics</span><span class="ss">(</span><span class="nv">self</span>$<span class="nv">geom</span>$<span class="nv">required_aes</span>, <span class="nv">c</span><span class="ss">(</span><span class="nv">names</span><span class="ss">(</span><span class="nv">data</span><span class="ss">)</span>, 
  .     <span class="nv">names</span><span class="ss">(</span><span class="nv">self</span><span class="mh">$ae</span><span class="nv">s_params</span><span class="ss">))</span>, <span class="nv">snake_class</span><span class="ss">(</span><span class="nv">self</span>$<span class="nv">geom</span><span class="ss">))</span>
<span class="mi">24</span>. <span class="nv">stop</span><span class="ss">(</span><span class="nv">name</span>, <span class="s2">&quot;</span><span class="s"> requires the following missing aesthetics: </span><span class="s2">&quot;</span>, <span class="nv">paste</span><span class="ss">(</span><span class="nv">missing_aes</span>, 
  .     <span class="nv">collapse</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">, </span><span class="s2">&quot;</span><span class="ss">)</span>, <span class="nv">call</span>. <span class="o">=</span> <span class="nv">FALSE</span><span class="ss">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_72_1.png" /></p>
<p>So in fact we need <em>all</em> of the components described in the ggplot syntax.</p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_74_0.png" /></p>
<h2 id="ltmappingsgt"><code>&lt;MAPPINGS&gt;</code></h2>
<div class="codehilite"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="k">data</span><span class="o">=&lt;</span><span class="k">DATA</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+</span>
    <span class="o">&lt;</span><span class="n">GEOM_FUNCTION</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="n">aes</span><span class="p">(</span><span class="o">&lt;</span><span class="n">MAPPINGS</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>


<p>Visual property of objects in plot, i.e. size, shape, color. Can display points from other variables (in this case class) in different ways by changing value of aesthetic properties. These are known as <strong>levels</strong>, which is done in order to distinguish aesthetic values from data values.</p>
<div class="codehilite"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span>
</pre></div>


<table>
<thead><tr><th scope=col>manufacturer</th><th scope=col>model</th><th scope=col>displ</th><th scope=col>year</th><th scope=col>cyl</th><th scope=col>trans</th><th scope=col>drv</th><th scope=col>cty</th><th scope=col>hwy</th><th scope=col>fl</th><th scope=col>class</th></tr></thead>
<tbody>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>auto(l5)  </td><td>f         </td><td>18        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>1.8       </td><td>1999      </td><td>4         </td><td>manual(m5)</td><td>f         </td><td>21        </td><td>29        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>manual(m6)</td><td>f         </td><td>20        </td><td>31        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.0       </td><td>2008      </td><td>4         </td><td>auto(av)  </td><td>f         </td><td>21        </td><td>30        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>auto(l5)  </td><td>f         </td><td>16        </td><td>26        </td><td>p         </td><td>compact   </td></tr>
    <tr><td>audi      </td><td>a4        </td><td>2.8       </td><td>1999      </td><td>6         </td><td>manual(m5)</td><td>f         </td><td>18        </td><td>26        </td><td>p         </td><td>compact   </td></tr>
</tbody>
</table>

<div class="codehilite"><pre><span></span><span class="n">p1</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">))</span>
<span class="n">p2</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">class</span><span class="p">))</span>
<span class="n">p3</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">class</span><span class="p">))</span>
<span class="n">p4</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">class</span><span class="p">))</span>
<span class="nf">grid.arrange</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">,</span><span class="n">p4</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nv">Warning</span> <span class="nv">message</span>:
“<span class="nv">The</span> <span class="nv">shape</span> <span class="nv">palette</span> <span class="nv">can</span> <span class="nv">deal</span> <span class="nv">with</span> <span class="nv">a</span> <span class="nv">maximum</span> <span class="nv">of</span> <span class="mi">6</span> <span class="nv">discrete</span> <span class="nv">values</span> <span class="nv">because</span>
<span class="nv">more</span> <span class="nv">than</span> <span class="mi">6</span> <span class="nv">becomes</span> <span class="nv">difficult</span> <span class="nv">to</span> <span class="nv">discriminate</span><span class="c1">; you have 7. Consider</span>
<span class="nv">specifying</span> <span class="nv">shapes</span> <span class="nv">manually</span> <span class="k">if</span> <span class="nv">you</span> <span class="nv">must</span> <span class="nv">have</span> <span class="nv">them</span>.”<span class="nv">Warning</span> <span class="nv">message</span>:
“<span class="nv">Removed</span> <span class="mi">62</span> <span class="nv">rows</span> <span class="nv">containing</span> <span class="nv">missing</span> <span class="nv">values</span> <span class="ss">(</span><span class="nv">geom_point</span><span class="ss">)</span>.”<span class="nv">Warning</span> <span class="nv">message</span>:
“<span class="nv">Using</span> <span class="nv">size</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">discrete</span> <span class="nv">variable</span> <span class="nv">is</span> <span class="nv">not</span> <span class="nv">advised</span>.”<span class="nv">Warning</span> <span class="nv">message</span>:
“<span class="nv">Using</span> <span class="nv">alpha</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">discrete</span> <span class="nv">variable</span> <span class="nv">is</span> <span class="nv">not</span> <span class="nv">advised</span>.”
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_77_1.png" /></p>
<h3 id="levels">Levels</h3>
<p><strong>ggplot2</strong> automatically assigns a unique level of an aesthetic to a unique value of the variable. This process is known as scaling. It will also automatically select a scale to use with the aesthetic (i.e. continuous or discrete) as well as add a legend explaining the mapping between levels and values. That's why in the size mapping there's no shape for suv, and why the following two pieces of code do different things:</p>
<div class="codehilite"><pre><span></span><span class="c1"># for color property, all data points were assigned to &#39;blue&#39;, therefore ggplot2 assigns a single level to all of the</span>
<span class="c1"># points, which is red</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_79_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># here color is placed outside aesthetic mapping, so ggplot2 understands that we want color of points to be blue</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_80_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># cty is a continuous variable, so when mapped to color we get a gradient with bins instead</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cty</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_81_0.png" /></p>
<h3 id="continuous-vs-discrete-scales">Continuous vs discrete scales</h3>
<p>Generally continuous scales get chosen for numerical data and discrete scales are chosen for categorical data. If your data is numeric but in discrete categories you may have to use <code>as.factor()</code> in order to get proper levels.</p>
<div class="codehilite"><pre><span></span><span class="c1"># if we try to map cyl to shape we get an error because shape is only for discrete variables</span>
<span class="c1"># even though we only have cyl=4,5,6 or 8</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">cyl</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nv">ERROR</span> <span class="k">while</span> <span class="nv">rich</span> <span class="nv">displaying</span> <span class="nv">an</span> <span class="nv">object</span>: <span class="nv">Error</span>: <span class="nv">A</span> <span class="nv">continuous</span> <span class="nv">variable</span> <span class="nv">can</span> <span class="nv">not</span> <span class="nv">be</span> <span class="nv">mapped</span> <span class="nv">to</span> <span class="nv">shape</span>

<span class="nv">Traceback</span>:
<span class="mi">1</span>. <span class="nv">FUN</span><span class="ss">(</span><span class="nv">X</span>[[<span class="nv">i</span>]], ...<span class="ss">)</span>
<span class="mi">2</span>. <span class="nv">tryCatch</span><span class="ss">(</span><span class="nv">withCallingHandlers</span><span class="ss">(</span>{
 .     <span class="k">if</span> <span class="ss">(</span><span class="o">!</span><span class="nv">mime</span> <span class="o">%</span><span class="nv">in</span><span class="o">%</span> <span class="nv">names</span><span class="ss">(</span><span class="nv">repr</span>::<span class="nv">mime2repr</span><span class="ss">))</span> 
 .         <span class="nv">stop</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">No repr_* for mimetype </span><span class="s2">&quot;</span>, <span class="nv">mime</span>, <span class="s2">&quot;</span><span class="s"> in repr::mime2repr</span><span class="s2">&quot;</span><span class="ss">)</span>
 .     <span class="nv">rpr</span> <span class="o">&lt;-</span> <span class="nv">repr</span>::<span class="nv">mime2repr</span>[[<span class="nv">mime</span>]]<span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
 .     <span class="k">if</span> <span class="ss">(</span><span class="nv">is</span>.<span class="nv">null</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">))</span> 
 .         <span class="k">return</span><span class="ss">(</span><span class="nv">NULL</span><span class="ss">)</span>
 .     <span class="nv">prepare_content</span><span class="ss">(</span><span class="nv">is</span>.<span class="nv">raw</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">)</span>, <span class="nv">rpr</span><span class="ss">)</span>
 . }, <span class="nv">error</span> <span class="o">=</span> <span class="nv">error_handler</span><span class="ss">)</span>, <span class="nv">error</span> <span class="o">=</span> <span class="nv">outer_handler</span><span class="ss">)</span>
<span class="mi">3</span>. <span class="nv">tryCatchList</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">classes</span>, <span class="nv">parentenv</span>, <span class="nv">handlers</span><span class="ss">)</span>
<span class="mi">4</span>. <span class="nv">tryCatchOne</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">names</span>, <span class="nv">parentenv</span>, <span class="nv">handlers</span>[[<span class="mi">1</span><span class="nv">L</span>]]<span class="ss">)</span>
<span class="mi">5</span>. <span class="nv">doTryCatch</span><span class="ss">(</span><span class="k">return</span><span class="ss">(</span><span class="nv">expr</span><span class="ss">)</span>, <span class="nv">name</span>, <span class="nv">parentenv</span>, <span class="nv">handler</span><span class="ss">)</span>
<span class="mi">6</span>. <span class="nv">withCallingHandlers</span><span class="ss">(</span>{
 .     <span class="k">if</span> <span class="ss">(</span><span class="o">!</span><span class="nv">mime</span> <span class="o">%</span><span class="nv">in</span><span class="o">%</span> <span class="nv">names</span><span class="ss">(</span><span class="nv">repr</span>::<span class="nv">mime2repr</span><span class="ss">))</span> 
 .         <span class="nv">stop</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">No repr_* for mimetype </span><span class="s2">&quot;</span>, <span class="nv">mime</span>, <span class="s2">&quot;</span><span class="s"> in repr::mime2repr</span><span class="s2">&quot;</span><span class="ss">)</span>
 .     <span class="nv">rpr</span> <span class="o">&lt;-</span> <span class="nv">repr</span>::<span class="nv">mime2repr</span>[[<span class="nv">mime</span>]]<span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
 .     <span class="k">if</span> <span class="ss">(</span><span class="nv">is</span>.<span class="nv">null</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">))</span> 
 .         <span class="k">return</span><span class="ss">(</span><span class="nv">NULL</span><span class="ss">)</span>
 .     <span class="nv">prepare_content</span><span class="ss">(</span><span class="nv">is</span>.<span class="nv">raw</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">)</span>, <span class="nv">rpr</span><span class="ss">)</span>
 . }, <span class="nv">error</span> <span class="o">=</span> <span class="nv">error_handler</span><span class="ss">)</span>
<span class="mi">7</span>. <span class="nv">repr</span>::<span class="nv">mime2repr</span>[[<span class="nv">mime</span>]]<span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">8</span>. <span class="nv">repr_text</span>.<span class="nv">default</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">9</span>. <span class="nv">paste</span><span class="ss">(</span><span class="nv">capture</span>.<span class="nv">output</span><span class="ss">(</span><span class="nv">print</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">))</span>, <span class="nv">collapse</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="ss">)</span>
<span class="mi">10</span>. <span class="nv">capture</span>.<span class="nv">output</span><span class="ss">(</span><span class="nv">print</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">))</span>
<span class="mi">11</span>. <span class="nv">evalVis</span><span class="ss">(</span><span class="nv">expr</span><span class="ss">)</span>
<span class="mi">12</span>. <span class="nv">withVisible</span><span class="ss">(</span><span class="nv">eval</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">pf</span><span class="ss">))</span>
<span class="mi">13</span>. <span class="nv">eval</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">pf</span><span class="ss">)</span>
<span class="mi">14</span>. <span class="nv">eval</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">pf</span><span class="ss">)</span>
<span class="mi">15</span>. <span class="nv">print</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">16</span>. <span class="nv">print</span>.<span class="nv">ggplot</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">17</span>. <span class="nv">ggplot_build</span><span class="ss">(</span><span class="nv">x</span><span class="ss">)</span>
<span class="mi">18</span>. <span class="nv">ggplot_build</span>.<span class="nv">ggplot</span><span class="ss">(</span><span class="nv">x</span><span class="ss">)</span>
<span class="mi">19</span>. <span class="nv">by_layer</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nv">l</span>, <span class="nv">d</span><span class="ss">)</span> <span class="nv">l</span><span class="mh">$c</span><span class="nv">ompute_aesthetics</span><span class="ss">(</span><span class="nv">d</span>, <span class="nv">plot</span><span class="ss">))</span>
<span class="mi">20</span>. <span class="nv">f</span><span class="ss">(</span><span class="nv">l</span> <span class="o">=</span> <span class="nv">layers</span>[[<span class="nv">i</span>]], <span class="nv">d</span> <span class="o">=</span> <span class="nv">data</span>[[<span class="nv">i</span>]]<span class="ss">)</span>
<span class="mi">21</span>. <span class="nv">l</span><span class="mh">$c</span><span class="nv">ompute_aesthetics</span><span class="ss">(</span><span class="nv">d</span>, <span class="nv">plot</span><span class="ss">)</span>
<span class="mi">22</span>. <span class="nv">f</span><span class="ss">(</span>..., <span class="nv">self</span> <span class="o">=</span> <span class="nv">self</span><span class="ss">)</span>
<span class="mi">23</span>. <span class="nv">scales_add_defaults</span><span class="ss">(</span><span class="nv">plot</span>$<span class="nv">scales</span>, <span class="nv">data</span>, <span class="nv">aesthetics</span>, <span class="nv">plot</span>$<span class="nv">plot_env</span><span class="ss">)</span>
<span class="mi">24</span>. <span class="nv">scales</span><span class="mh">$add</span><span class="ss">(</span><span class="nv">find_scale</span><span class="ss">(</span><span class="nv">aes</span>, <span class="nv">datacols</span>[[<span class="nv">aes</span>]], <span class="nv">env</span><span class="ss">))</span>
<span class="mi">25</span>. <span class="nv">f</span><span class="ss">(</span>..., <span class="nv">self</span> <span class="o">=</span> <span class="nv">self</span><span class="ss">)</span>
<span class="mi">26</span>. <span class="nv">find_scale</span><span class="ss">(</span><span class="nv">aes</span>, <span class="nv">datacols</span>[[<span class="nv">aes</span>]], <span class="nv">env</span><span class="ss">)</span>
<span class="mi">27</span>. <span class="nv">scale_f</span><span class="ss">()</span>
<span class="mi">28</span>. <span class="nv">stop</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">A continuous variable can not be mapped to shape</span><span class="s2">&quot;</span>, <span class="nv">call</span>. <span class="o">=</span> <span class="nv">FALSE</span><span class="ss">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_83_1.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># will transform into categorical variable with levels</span>
<span class="nf">as.factor</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">cyl</span><span class="p">)</span>
</pre></div>


<ol class=list-inline>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>6</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>8</li>
    <li>8</li>
    <li>6</li>
    <li>6</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>8</li>
    <li>6</li>
    <li>6</li>
    <li>8</li>
    <li>8</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>8</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>8</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>8</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>8</li>
    <li>8</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>5</li>
    <li>5</li>
    <li>6</li>
    <li>6</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>5</li>
    <li>5</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>4</li>
    <li>6</li>
    <li>6</li>
    <li>6</li>
</ol>

<details>
    <summary style=display:list-item;cursor:pointer>
        <strong>Levels</strong>:
    </summary>
    <ol class=list-inline>
        <li>'4'</li>
        <li>'5'</li>
        <li>'6'</li>
        <li>'8'</li>
    </ol>
</details>

<div class="codehilite"><pre><span></span><span class="c1"># all is well when we use as.factor()</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="nf">as.factor</span><span class="p">(</span><span class="n">cyl</span><span class="p">)))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_85_0.png" /></p>
<p>Note that this means x and y are aesthetic mappings as well. In fact without them you will get an error.</p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nv">ERROR</span> <span class="k">while</span> <span class="nv">rich</span> <span class="nv">displaying</span> <span class="nv">an</span> <span class="nv">object</span>: <span class="nv">Error</span>: <span class="nv">geom_point</span> <span class="nv">requires</span> <span class="nv">the</span> <span class="nv">following</span> <span class="nv">missing</span> <span class="nv">aesthetics</span>: <span class="nv">x</span>, <span class="nv">y</span>

<span class="nv">Traceback</span>:
<span class="mi">1</span>. <span class="nv">FUN</span><span class="ss">(</span><span class="nv">X</span>[[<span class="nv">i</span>]], ...<span class="ss">)</span>
<span class="mi">2</span>. <span class="nv">tryCatch</span><span class="ss">(</span><span class="nv">withCallingHandlers</span><span class="ss">(</span>{
 .     <span class="k">if</span> <span class="ss">(</span><span class="o">!</span><span class="nv">mime</span> <span class="o">%</span><span class="nv">in</span><span class="o">%</span> <span class="nv">names</span><span class="ss">(</span><span class="nv">repr</span>::<span class="nv">mime2repr</span><span class="ss">))</span> 
 .         <span class="nv">stop</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">No repr_* for mimetype </span><span class="s2">&quot;</span>, <span class="nv">mime</span>, <span class="s2">&quot;</span><span class="s"> in repr::mime2repr</span><span class="s2">&quot;</span><span class="ss">)</span>
 .     <span class="nv">rpr</span> <span class="o">&lt;-</span> <span class="nv">repr</span>::<span class="nv">mime2repr</span>[[<span class="nv">mime</span>]]<span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
 .     <span class="k">if</span> <span class="ss">(</span><span class="nv">is</span>.<span class="nv">null</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">))</span> 
 .         <span class="k">return</span><span class="ss">(</span><span class="nv">NULL</span><span class="ss">)</span>
 .     <span class="nv">prepare_content</span><span class="ss">(</span><span class="nv">is</span>.<span class="nv">raw</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">)</span>, <span class="nv">rpr</span><span class="ss">)</span>
 . }, <span class="nv">error</span> <span class="o">=</span> <span class="nv">error_handler</span><span class="ss">)</span>, <span class="nv">error</span> <span class="o">=</span> <span class="nv">outer_handler</span><span class="ss">)</span>
<span class="mi">3</span>. <span class="nv">tryCatchList</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">classes</span>, <span class="nv">parentenv</span>, <span class="nv">handlers</span><span class="ss">)</span>
<span class="mi">4</span>. <span class="nv">tryCatchOne</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">names</span>, <span class="nv">parentenv</span>, <span class="nv">handlers</span>[[<span class="mi">1</span><span class="nv">L</span>]]<span class="ss">)</span>
<span class="mi">5</span>. <span class="nv">doTryCatch</span><span class="ss">(</span><span class="k">return</span><span class="ss">(</span><span class="nv">expr</span><span class="ss">)</span>, <span class="nv">name</span>, <span class="nv">parentenv</span>, <span class="nv">handler</span><span class="ss">)</span>
<span class="mi">6</span>. <span class="nv">withCallingHandlers</span><span class="ss">(</span>{
 .     <span class="k">if</span> <span class="ss">(</span><span class="o">!</span><span class="nv">mime</span> <span class="o">%</span><span class="nv">in</span><span class="o">%</span> <span class="nv">names</span><span class="ss">(</span><span class="nv">repr</span>::<span class="nv">mime2repr</span><span class="ss">))</span> 
 .         <span class="nv">stop</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">No repr_* for mimetype </span><span class="s2">&quot;</span>, <span class="nv">mime</span>, <span class="s2">&quot;</span><span class="s"> in repr::mime2repr</span><span class="s2">&quot;</span><span class="ss">)</span>
 .     <span class="nv">rpr</span> <span class="o">&lt;-</span> <span class="nv">repr</span>::<span class="nv">mime2repr</span>[[<span class="nv">mime</span>]]<span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
 .     <span class="k">if</span> <span class="ss">(</span><span class="nv">is</span>.<span class="nv">null</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">))</span> 
 .         <span class="k">return</span><span class="ss">(</span><span class="nv">NULL</span><span class="ss">)</span>
 .     <span class="nv">prepare_content</span><span class="ss">(</span><span class="nv">is</span>.<span class="nv">raw</span><span class="ss">(</span><span class="nv">rpr</span><span class="ss">)</span>, <span class="nv">rpr</span><span class="ss">)</span>
 . }, <span class="nv">error</span> <span class="o">=</span> <span class="nv">error_handler</span><span class="ss">)</span>
<span class="mi">7</span>. <span class="nv">repr</span>::<span class="nv">mime2repr</span>[[<span class="nv">mime</span>]]<span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">8</span>. <span class="nv">repr_text</span>.<span class="nv">default</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">9</span>. <span class="nv">paste</span><span class="ss">(</span><span class="nv">capture</span>.<span class="nv">output</span><span class="ss">(</span><span class="nv">print</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">))</span>, <span class="nv">collapse</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="ss">)</span>
<span class="mi">10</span>. <span class="nv">capture</span>.<span class="nv">output</span><span class="ss">(</span><span class="nv">print</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">))</span>
<span class="mi">11</span>. <span class="nv">evalVis</span><span class="ss">(</span><span class="nv">expr</span><span class="ss">)</span>
<span class="mi">12</span>. <span class="nv">withVisible</span><span class="ss">(</span><span class="nv">eval</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">pf</span><span class="ss">))</span>
<span class="mi">13</span>. <span class="nv">eval</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">pf</span><span class="ss">)</span>
<span class="mi">14</span>. <span class="nv">eval</span><span class="ss">(</span><span class="nv">expr</span>, <span class="nv">pf</span><span class="ss">)</span>
<span class="mi">15</span>. <span class="nv">print</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">16</span>. <span class="nv">print</span>.<span class="nv">ggplot</span><span class="ss">(</span><span class="nv">obj</span><span class="ss">)</span>
<span class="mi">17</span>. <span class="nv">ggplot_build</span><span class="ss">(</span><span class="nv">x</span><span class="ss">)</span>
<span class="mi">18</span>. <span class="nv">ggplot_build</span>.<span class="nv">ggplot</span><span class="ss">(</span><span class="nv">x</span><span class="ss">)</span>
<span class="mi">19</span>. <span class="nv">by_layer</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nv">l</span>, <span class="nv">d</span><span class="ss">)</span> <span class="nv">l</span><span class="mh">$c</span><span class="nv">ompute_geom_1</span><span class="ss">(</span><span class="nv">d</span><span class="ss">))</span>
<span class="mi">20</span>. <span class="nv">f</span><span class="ss">(</span><span class="nv">l</span> <span class="o">=</span> <span class="nv">layers</span>[[<span class="nv">i</span>]], <span class="nv">d</span> <span class="o">=</span> <span class="nv">data</span>[[<span class="nv">i</span>]]<span class="ss">)</span>
<span class="mi">21</span>. <span class="nv">l</span><span class="mh">$c</span><span class="nv">ompute_geom_1</span><span class="ss">(</span><span class="nv">d</span><span class="ss">)</span>
<span class="mi">22</span>. <span class="nv">f</span><span class="ss">(</span>..., <span class="nv">self</span> <span class="o">=</span> <span class="nv">self</span><span class="ss">)</span>
<span class="mi">23</span>. <span class="nv">check_required_aesthetics</span><span class="ss">(</span><span class="nv">self</span>$<span class="nv">geom</span>$<span class="nv">required_aes</span>, <span class="nv">c</span><span class="ss">(</span><span class="nv">names</span><span class="ss">(</span><span class="nv">data</span><span class="ss">)</span>, 
  .     <span class="nv">names</span><span class="ss">(</span><span class="nv">self</span><span class="mh">$ae</span><span class="nv">s_params</span><span class="ss">))</span>, <span class="nv">snake_class</span><span class="ss">(</span><span class="nv">self</span>$<span class="nv">geom</span><span class="ss">))</span>
<span class="mi">24</span>. <span class="nv">stop</span><span class="ss">(</span><span class="nv">name</span>, <span class="s2">&quot;</span><span class="s"> requires the following missing aesthetics: </span><span class="s2">&quot;</span>, <span class="nv">paste</span><span class="ss">(</span><span class="nv">missing_aes</span>, 
  .     <span class="nv">collapse</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">, </span><span class="s2">&quot;</span><span class="ss">)</span>, <span class="nv">call</span>. <span class="o">=</span> <span class="nv">FALSE</span><span class="ss">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_87_1.png" /></p>
<h2 id="ltgeom_functiongt"><code>&lt;GEOM_FUNCTION&gt;</code></h2>
<div class="codehilite"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="k">data</span><span class="o">=&lt;</span><span class="k">DATA</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+</span>
    <span class="o">&lt;</span><span class="n">GEOM_FUNCTION</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="n">aes</span><span class="p">(</span><span class="o">&lt;</span><span class="n">MAPPINGS</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>


<p><strong>geom</strong> geometrical object plot uses to represent data. Bar charts use bar geoms, line charts use line geoms, boxplots, etc. Scatterplots use point geoms. Full list of geoms provided with <strong>ggplot2</strong> can be seen in <a href="https://ggplot2.tidyverse.org/reference/#section-layer-geoms">ggplot2 reference</a>. Also exist other geoms created by <a href="http://www.ggplot2-exts.org/gallery/">other packages</a>.</p>
<p>Every geom function in ggplot2 takes a <code>mapping</code> argument with specific aesthetic mappings that are possible. Not every aesthetic will work with every geom. For example, can set shape of a point, but not shape of a line. However, can set linetype of a line.</p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">displ</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">`</span><span class="n">geom_smooth</span><span class="p">()</span><span class="o">`</span> <span class="k">using</span> <span class="k">method</span> <span class="o">=</span> <span class="s1">&#39;loess&#39;</span> <span class="k">and</span> <span class="n">formula</span> <span class="s1">&#39;y ~ x&#39;</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_89_1.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># data has been separated into three lines based on their drivetrain: 4 (4wd), f (front), r (rear)</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">displ</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="n">drv</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">`</span><span class="n">geom_smooth</span><span class="p">()</span><span class="o">`</span> <span class="k">using</span> <span class="k">method</span> <span class="o">=</span> <span class="s1">&#39;loess&#39;</span> <span class="k">and</span> <span class="n">formula</span> <span class="s1">&#39;y ~ x&#39;</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_90_1.png" /></p>
<p>Can display multiple geoms on same plot just by adding them</p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">displ</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">drv</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">displ</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">drv</span><span class="p">,</span> <span class="n">linetype</span><span class="o">=</span><span class="n">drv</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">`</span><span class="n">geom_smooth</span><span class="p">()</span><span class="o">`</span> <span class="k">using</span> <span class="k">method</span> <span class="o">=</span> <span class="s1">&#39;loess&#39;</span> <span class="k">and</span> <span class="n">formula</span> <span class="s1">&#39;y ~ x&#39;</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_92_1.png" /></p>
<p>Geoms like <code>geom_smooth()</code> use single geometric object to display multiple rows of data. If you don't necessarily want to add other distinguishing features to the geom like color, can use <code>group</code> aesthetic (for a categorical variable) to draw multiple objects.</p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="n">drv</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">`</span><span class="n">geom_smooth</span><span class="p">()</span><span class="o">`</span> <span class="k">using</span> <span class="k">method</span> <span class="o">=</span> <span class="s1">&#39;loess&#39;</span> <span class="k">and</span> <span class="n">formula</span> <span class="s1">&#39;y ~ x&#39;</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_94_1.png" /></p>
<h3 id="global-mappings-vs-local-mappings">Global mappings vs local mappings</h3>
<p><code>ggplot()</code> function contains <em>global</em> mapping, while each geom has a local mapping</p>
<ul>
<li><code>lm</code> from <strong>stats</strong> for linear models (you can also fit other models)</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># global mapping of displ and hwy creates x and yaxis</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_96_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># mapping color to class for point geom while using global x and y mappings</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">))</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_97_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># geom_smooth doesn&#39;t need any mapping arguments if using global</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">))</span><span class="o">+</span>
    <span class="nf">geom_smooth</span><span class="p">()</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">`</span><span class="n">geom_smooth</span><span class="p">()</span><span class="o">`</span> <span class="k">using</span> <span class="k">method</span> <span class="o">=</span> <span class="s1">&#39;loess&#39;</span> <span class="k">and</span> <span class="n">formula</span> <span class="s1">&#39;y ~ x&#39;</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_98_1.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># second geom_smooth uses same x and y mapping</span>
<span class="c1"># but mapping comes from no_2seaters data (from Transform section) instead</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">displ</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_smooth</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">no_2seaters</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">`</span><span class="n">geom_smooth</span><span class="p">()</span><span class="o">`</span> <span class="k">using</span> <span class="k">method</span> <span class="o">=</span> <span class="s1">&#39;loess&#39;</span> <span class="k">and</span> <span class="n">formula</span> <span class="s1">&#39;y ~ x&#39;</span>
<span class="o">`</span><span class="n">geom_smooth</span><span class="p">()</span><span class="o">`</span> <span class="k">using</span> <span class="k">method</span> <span class="o">=</span> <span class="s1">&#39;loess&#39;</span> <span class="k">and</span> <span class="n">formula</span> <span class="s1">&#39;y ~ x&#39;</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_99_1.png" /></p>
<h2 id="more-syntax">More syntax</h2>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">DATA</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="o">&lt;</span><span class="n">GEOM_FUNCTION</span><span class="o">&gt;</span><span class="p">(</span>
     <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="o">&lt;</span><span class="n">MAPPINGS</span><span class="o">&gt;</span><span class="p">),</span>
     <span class="n">stat</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">STAT</span><span class="o">&gt;</span><span class="p">,</span> 
     <span class="n">position</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">POSITION</span><span class="o">&gt;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="o">&lt;</span><span class="n">COORDINATE_FUNCTION</span><span class="o">&gt;</span> <span class="o">+</span>
  <span class="o">&lt;</span><span class="n">FACET_FUNCTION</span><span class="o">&gt;</span>
</pre></div>


<h2 id="facets">Facets</h2>
<p>Subplots displaying one subset of data.</p>
<ul>
<li><code>facet_wrap()</code> for a single variable.</li>
<li><code>facet_grid()</code> for along 2 variables.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span> <span class="n">class</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_102_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span> <span class="n">class</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_103_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span> <span class="n">class</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_104_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># some facets are empty because no observations have those combos</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">displ</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">facet_grid</span><span class="p">(</span><span class="n">drv</span> <span class="o">~</span> <span class="n">cyl</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_105_0.png" /></p>
<h2 id="stats">Stats</h2>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">DATA</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="o">&lt;</span><span class="n">GEOM_FUNCTION</span><span class="o">&gt;</span><span class="p">(</span>
     <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="o">&lt;</span><span class="n">MAPPINGS</span><span class="o">&gt;</span><span class="p">),</span>
     <span class="n">stat</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">STAT</span><span class="o">&gt;</span><span class="p">,</span> 
     <span class="n">position</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">POSITION</span><span class="o">&gt;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="o">&lt;</span><span class="n">COORDINATE_FUNCTION</span><span class="o">&gt;</span> <span class="o">+</span>
  <span class="o">&lt;</span><span class="n">FACET_FUNCTION</span><span class="o">&gt;</span>
</pre></div>


<p>Algorithm used to calculate new values for a graph. Each geom object has a default stat, and each stat has a default geom. Geoms like <code>geom_point()</code> will leave data as is, known as <code>stat_identity()</code>. Graphs like bar charts and histograms will bin your data and compute bin counts, known as <code>stat_count()</code>. Can see full list of stats at <a href="https://ggplot2.tidyverse.org/reference/">ggplot2 reference</a> under both Layer: geoms and Layer: stats.</p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">geom_bar</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_107_0.png" /></p>
<p>Since each stat comes with a default geom, can use stat to create geoms on plots as well.</p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">stat_count</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_109_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># because stat_count() computes count and prop, can use those as variables for mapping as well</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_bar</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">..prop..</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_110_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># stat_summary is associated with geom_pointrange</span>
<span class="c1"># default is to compute mean and standard error</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">hwy</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="k">No</span> <span class="n">summary</span> <span class="k">function</span> <span class="n">supplied</span><span class="p">,</span> <span class="n">defaulting</span> <span class="k">to</span> <span class="o">`</span><span class="n">mean_se</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_111_1.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># can change stat_summary to compute median and min/max instead</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">class</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">),</span>
    <span class="n">fun.ymin</span> <span class="o">=</span> <span class="n">min</span><span class="p">,</span>
    <span class="n">fun.ymax</span> <span class="o">=</span> <span class="n">max</span><span class="p">,</span>
    <span class="n">fun.y</span> <span class="o">=</span> <span class="n">median</span>
  <span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_112_0.png" /></p>
<h2 id="position-adjustments">Position adjustments</h2>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">DATA</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="o">&lt;</span><span class="n">GEOM_FUNCTION</span><span class="o">&gt;</span><span class="p">(</span>
     <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="o">&lt;</span><span class="n">MAPPINGS</span><span class="o">&gt;</span><span class="p">),</span>
     <span class="n">stat</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">STAT</span><span class="o">&gt;</span><span class="p">,</span> 
     <span class="n">position</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">POSITION</span><span class="o">&gt;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="o">&lt;</span><span class="n">COORDINATE_FUNCTION</span><span class="o">&gt;</span> <span class="o">+</span>
  <span class="o">&lt;</span><span class="n">FACET_FUNCTION</span><span class="o">&gt;</span>
</pre></div>


<p>Each geom also comes with a default <strong>position adjustment</strong> specified by <code>position</code> argument. For geoms like <code>geom_point()</code> it is "identity" which is position as is.</p>
<p>Specifically for bar charts, have fill aesthetic. If fill aesthetic gets mapped to another variable, bars are automatically stacked under the "stack" position. Can see <a href="https://ggplot2.tidyverse.org/reference/#section-layer-position-adjustment">list of positions</a> at ggplot2 reference.</p>
<div class="codehilite"><pre><span></span><span class="n">p1</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="nf">as.factor</span><span class="p">(</span><span class="n">cyl</span><span class="p">)))</span>
<span class="n">p1</span> <span class="o">+</span> <span class="nf">geom_bar</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_114_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># position = identity will place each object exactly where it falls in context of graph.</span>
<span class="c1"># Not useful for bar charts, better for scatterplots.</span>
<span class="n">p1</span> <span class="o">+</span> <span class="nf">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_115_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># position = fill will make bars same height</span>
<span class="n">p1</span> <span class="o">+</span> <span class="nf">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s">&quot;fill&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_116_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># position = &quot;dodge&quot; places objects directly beside one another. Easier to compare individual values.</span>
<span class="n">p1</span> <span class="o">+</span> <span class="nf">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s">&quot;dodge&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_117_0.png" /></p>
<p>For <code>geom_point</code> one possible position is "jitter", which will add a small amount of random noise to each point. This spreads points out so that it's unlikely for points to overlap and therefore get plotted over each other. For example it's possible that majority of points are actually one combination of <code>hwy</code> and <code>displ</code> but they all get plotted at the exact same point so you can't tell. For very large datasets can help prevent overplotting to better see where mass of plot is or trends.</p>
<div class="codehilite"><pre><span></span><span class="c1"># seems quite uniform which suggests multiple observations with same value of cty/hwy</span>
<span class="c1"># creating overlapping points</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">cty</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_point</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_119_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># definitely the case</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">cty</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s">&quot;jitter&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_120_0.png" /></p>
<h2 id="coordinate-systems">Coordinate systems</h2>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">DATA</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="o">&lt;</span><span class="n">GEOM_FUNCTION</span><span class="o">&gt;</span><span class="p">(</span>
     <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="o">&lt;</span><span class="n">MAPPINGS</span><span class="o">&gt;</span><span class="p">),</span>
     <span class="n">stat</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">STAT</span><span class="o">&gt;</span><span class="p">,</span> 
     <span class="n">position</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">POSITION</span><span class="o">&gt;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="o">&lt;</span><span class="n">COORDINATE_FUNCTION</span><span class="o">&gt;</span> <span class="o">+</span>
  <span class="o">&lt;</span><span class="n">FACET_FUNCTION</span><span class="o">&gt;</span>
</pre></div>


<p>Default coordinate system is Cartesian.</p>
<ul>
<li><code>coord_flip()</code> switches x and y axes.</li>
<li><code>coord_quickmap()</code> sets aspect ratio for maps.</li>
<li><code>coord_polar()</code> sets polar coordinates.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">p</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">class</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">))</span>
<span class="n">p</span> <span class="o">+</span> <span class="nf">geom_boxplot</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_122_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># flipping coordinates</span>
<span class="n">p</span> <span class="o">+</span> <span class="nf">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> <span class="nf">coord_flip</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_123_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># can reorder x axis by lowest to highest median hwy mileage</span>
<span class="c1"># allows easier comparisons</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nf">reorder</span><span class="p">(</span><span class="n">class</span><span class="p">,</span><span class="n">hwy</span><span class="p">,</span><span class="n">FUN</span><span class="o">=</span><span class="n">median</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_boxplot</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">coord_flip</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_124_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># Setting aspect ratio correctly</span>
<span class="n">nz</span> <span class="o">&lt;-</span> <span class="nf">map_data</span><span class="p">(</span><span class="s">&quot;nz&quot;</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_polygon</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_polygon</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">coord_quickmap</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_125_0.png" /></p>
<p><img alt="png" src="../workshop_files/workshop_125_1.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1"># polar coordinates</span>
<span class="n">bar</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">geom_bar</span><span class="p">(</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">class</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">cyl</span><span class="p">)),</span> 
    <span class="n">show.legend</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
    <span class="n">width</span> <span class="o">=</span> <span class="m">1</span>
  <span class="p">)</span> <span class="o">+</span> 
  <span class="nf">theme</span><span class="p">(</span><span class="n">aspect.ratio</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span>

<span class="n">p1</span> <span class="o">&lt;-</span> <span class="n">bar</span> <span class="o">+</span> <span class="nf">coord_flip</span><span class="p">()</span>
<span class="n">p2</span> <span class="o">&lt;-</span> <span class="n">bar</span> <span class="o">+</span> <span class="nf">coord_polar</span><span class="p">()</span>
<span class="nf">grid.arrange</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_126_0.png" /></p>
<h1 id="summary">Summary</h1>
<p>Now that we've gone through tidying, transforming, and visualizing data let's review all of the different functions we've used and in some cases learned the inner workings of:</p>
<h2 id="tidying">Tidying</h2>
<ul>
<li><code>gather()</code></li>
<li><code>spread()</code></li>
<li><code>separate()</code></li>
<li><code>unite()</code></li>
<li><code>%&gt;%</code> propagates the output from a function as input to another. eg: x %&gt;% f(y) becomes f(x,y), and x %&gt;% f(y) %&gt;% g(z) becomes g(f(x,y),z).</li>
</ul>
<h2 id="transforming">Transforming</h2>
<ul>
<li><code>filter()</code> to pick observations (rows) by their values</li>
<li><code>arrange()</code> to reorder rows, default is by ascending value</li>
<li><code>select()</code> to pick variables (columns) by their names</li>
<li><code>mutate()</code> to create new variables with functions of existing variables</li>
<li><code>summarise()</code> to collapes many values down to a single summary</li>
<li><code>group_by()</code> to set up functions to operate on groups rather than the whole data set</li>
</ul>
<h2 id="visualizing">Visualizing</h2>
<ul>
<li><code>ggplot</code> - global data and mappings</li>
<li><code>geom_point</code> - geom for scatterplots</li>
<li><code>geom_smooth</code> - geom for regressions</li>
<li><code>geom_pointrange</code> - geom for vertical intervals defined by <code>x</code>, <code>y</code>, <code>ymin</code>, and <code>ymax</code></li>
<li><code>geom_bar</code> - geom for barcharts</li>
<li><code>geom_boxplot</code> - geom for boxplots</li>
<li><code>geom_polygon</code> - geom for polygons</li>
<li><code>aes(color)</code> - color mapping</li>
<li><code>aes(shape)</code> - shape mapping</li>
<li><code>aes(size)</code> - size mapping</li>
<li><code>aes(alpha)</code> - transparency mapping</li>
<li><code>as.factor()</code> - transforming numerical values to categorical values with levels</li>
<li><code>facet_grid</code></li>
<li><code>facet_wrap</code></li>
<li><code>stat_count</code> - default stat for barcharts, bins by x and counts</li>
<li><code>stat_identity</code> - default stat for scatterplots, leaves data as is</li>
<li><code>stat_summary</code> - default stat for pointrange, by default computes mean and se of y by x</li>
<li><code>position="identity"</code></li>
<li><code>position="stacked"</code></li>
<li><code>position="fill"</code></li>
<li><code>position="dodge"</code></li>
<li><code>position="jitter"</code></li>
<li><code>coord_flip</code></li>
<li><code>coord_map</code></li>
<li><code>coord_polar</code></li>
</ul>
<h1 id="publication-quality-graphs">Publication Quality Graphs</h1>
<p>Last piece with some additional functions to learn...</p>
<h2 id="labels">Labels</h2>
<p><code>labs()</code> to add most kinds of labels: title, subtitle, captions, x-axis, y-axis, legend, etc.</p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Fuel efficiency generally decreases with engine size&quot;</span><span class="p">,</span>
    <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&quot;Two seaters (sports cars) are an exception because of their light weight&quot;</span><span class="p">,</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="s">&quot;Data from fueleconomy.gov&quot;</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Engine displacement (L)&quot;</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;Highway fuel economy (mpg)&quot;</span><span class="p">,</span>
    <span class="n">colour</span> <span class="o">=</span> <span class="s">&quot;Car type&quot;</span>
  <span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">`</span><span class="n">geom_smooth</span><span class="p">()</span><span class="o">`</span> <span class="k">using</span> <span class="k">method</span> <span class="o">=</span> <span class="s1">&#39;loess&#39;</span> <span class="k">and</span> <span class="n">formula</span> <span class="s1">&#39;y ~ x&#39;</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_129_1.png" /></p>
<h2 id="annotations">Annotations</h2>
<p>Can use <code>geom_text()</code> to add text labesls on the plot.</p>
<div class="codehilite"><pre><span></span><span class="n">best_in_class</span> <span class="o">&lt;-</span> <span class="n">mpg</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">class</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="nf">row_number</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">hwy</span><span class="p">))</span> <span class="o">==</span> <span class="m">1</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">best_in_class</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_131_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">best_in_class</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">ggrepel</span><span class="o">::</span><span class="nf">geom_label_repel</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">model</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">best_in_class</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="s">&quot;Data from fueleconomy.gov&quot;</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Engine displacement (L)&quot;</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;Highway fuel economy (mpg)&quot;</span><span class="p">,</span>
    <span class="n">colour</span> <span class="o">=</span> <span class="s">&quot;Car type&quot;</span>
  <span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_132_0.png" /></p>
<h2 id="scales">Scales</h2>
<ul>
<li><code>breaks</code>: For the position of ticks</li>
<li><code>labels</code>: For the text label associated with each tick.</li>
<li>Default scale is x continuous, y continuous but can also do x logarithmic, y logarithmic, change color scales.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">15</span><span class="p">,</span> <span class="m">40</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_134_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_135_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="n">p1</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">carat</span><span class="p">,</span> <span class="n">price</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_bin2d</span><span class="p">()</span>

<span class="n">p2</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="nf">log10</span><span class="p">(</span><span class="n">carat</span><span class="p">),</span> <span class="nf">log10</span><span class="p">(</span><span class="n">price</span><span class="p">)))</span> <span class="o">+</span>
  <span class="nf">geom_bin2d</span><span class="p">()</span>

<span class="n">p3</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">carat</span><span class="p">,</span> <span class="n">price</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_bin2d</span><span class="p">()</span> <span class="o">+</span> 
  <span class="nf">scale_x_log10</span><span class="p">()</span> <span class="o">+</span> 
  <span class="nf">scale_y_log10</span><span class="p">()</span>

<span class="nf">grid.arrange</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_136_0.png" /></p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">drv</span><span class="p">))</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">drv</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">scale_colour_brewer</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&quot;Set1&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_137_0.png" /></p>
<p><img alt="png" src="../workshop_files/workshop_137_1.png" /></p>
<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">drv</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">scale_colour_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">`4`</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="../workshop_files/workshop_138_0.png" /></p>
<h2 id="legend-positioning">Legend positioning</h2>
<p><code>theme(legend.position)</code> to control legend position. <code>guides()</code> with <code>guide_legened()</code> or <code>guide_colourbar()</code> for legend display.</p>
<div class="codehilite"><pre><span></span><span class="n">base</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span>

<span class="n">p1</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;left&quot;</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;top&quot;</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">p4</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;right&quot;</span><span class="p">)</span>

<span class="nf">grid.arrange</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">,</span><span class="n">p4</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;bottom&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">guides</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">nrow</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">override.aes</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">4</span><span class="p">)))</span>
</pre></div>


<h2 id="zooming">Zooming</h2>
<p>Three ways to control plot limits:
 * Adjusting what data are plotted
 * Setting limits in each scale
 * Setting <code>xlim</code> and <code>ylim</code> in <code>coord_cartesian()</code></p>
<div class="codehilite"><pre><span></span><span class="c1"># asetting xlim and ylim in coord_cartesian</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">7</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">30</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># adjusting what data are plotted</span>
<span class="c1"># however geom_smooth will plot regression over subsetted data</span>
<span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">displ</span> <span class="o">&gt;=</span> <span class="m">5</span><span class="p">,</span> <span class="n">displ</span> <span class="o">&lt;=</span> <span class="m">7</span><span class="p">,</span> <span class="n">hwy</span> <span class="o">&gt;=</span> <span class="m">10</span><span class="p">,</span> <span class="n">hwy</span> <span class="o">&lt;=</span> <span class="m">30</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">()</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># 2 plots use subsetted data therefore have different scales along hwy and displ</span>
<span class="n">suv</span> <span class="o">&lt;-</span> <span class="n">mpg</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">class</span> <span class="o">==</span> <span class="s">&quot;suv&quot;</span><span class="p">)</span>
<span class="n">compact</span> <span class="o">&lt;-</span> <span class="n">mpg</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">class</span> <span class="o">==</span> <span class="s">&quot;compact&quot;</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">suv</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">drv</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">compact</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">drv</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># can set limits in each scale</span>
<span class="n">x_scale</span> <span class="o">&lt;-</span> <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">displ</span><span class="p">))</span>
<span class="n">y_scale</span> <span class="o">&lt;-</span> <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">hwy</span><span class="p">))</span>
<span class="n">col_scale</span> <span class="o">&lt;-</span> <span class="nf">scale_colour_discrete</span><span class="p">(</span><span class="n">limits</span> <span class="o">=</span> <span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">drv</span><span class="p">))</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">suv</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">drv</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="n">x_scale</span> <span class="o">+</span>
  <span class="n">y_scale</span> <span class="o">+</span>
  <span class="n">col_scale</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">compact</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">drv</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="n">x_scale</span> <span class="o">+</span>
  <span class="n">y_scale</span> <span class="o">+</span>
  <span class="n">col_scale</span>
</pre></div>


<h2 id="themes">Themes</h2>
<p><strong>ggplot2</strong> has 8 themes by default, can get more in other packages like <strong>ggthemes</strong>. Generally prefer <code>theme_classic()</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">base</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>

<span class="n">p1</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme_bw</span><span class="p">()</span>
<span class="n">p2</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme_light</span><span class="p">()</span>
<span class="n">p3</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span>
<span class="n">p4</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme_linedraw</span><span class="p">()</span>
<span class="n">p5</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme_dark</span><span class="p">()</span>
<span class="n">p6</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme_minimal</span><span class="p">()</span>
<span class="n">p7</span> <span class="o">&lt;-</span> <span class="n">base</span> <span class="o">+</span> <span class="nf">theme_void</span><span class="p">()</span>

<span class="nf">grid.arrange</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">,</span><span class="n">p4</span><span class="p">,</span><span class="n">p5</span><span class="p">,</span><span class="n">p6</span><span class="p">,</span><span class="n">p7</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>
</pre></div>


<h2 id="saving-your-plots">Saving your plots</h2>
<ul>
<li><code>ggsave()</code> will save most recent plot to disk</li>
<li><code>tiff()</code> will save next plot to disk</li>
<li>Other functions like <code>postscript()</code> for eps files, etc.</li>
<li>All can take <code>width</code>, <code>height</code>, <code>fonts</code>, <code>pointsize</code>, <code>res</code> (resolution) arguments</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">p1</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">displ</span><span class="p">,</span> <span class="n">hwy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Engine displacement (L)&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Heighway fuel economy (mpg)&quot;</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Fuel efficiency generally decreases with engine size&quot;</span><span class="p">,</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="s">&quot;Data from fueleconomy.gov&quot;</span><span class="p">,</span>
    <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&quot;Two seaters (sports cars) are an exception because of their light weight&quot;</span><span class="p">,</span>
    <span class="n">colour</span> <span class="o">=</span> <span class="s">&quot;Car type&quot;</span>
  <span class="p">)</span> <span class="o">+</span> <span class="n">x_scale</span> <span class="o">+</span> <span class="n">y_scale</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span>
<span class="n">p1</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="s">&quot;my_plot.pdf&quot;</span><span class="p">)</span>

<span class="nf">tiff</span><span class="p">(</span><span class="s">&quot;my_plot.tiff&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="m">7</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&quot;in&quot;</span><span class="p">,</span><span class="n">pointsize</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="m">350</span><span class="p">)</span>
<span class="n">p1</span>
<span class="nf">dev.off</span><span class="p">()</span>
</pre></div>


<h1 id="some-other-useful-visualization-packages">Some other useful visualization packages</h1>
<p>We don't have time in this workshop to get in depth to other workshops, but here are some more useful visualization packages that may be helpful for your research.</p>
<h2 id="ggtree-for-phylogenetics">ggtree for phylogenetics</h2>
<p>Resources and associated packages:
 * <a href="https://yulab-smu.github.io/treedata-book/index.html">Data Integration, Manipulation and Visualization of Phylogenetic Trees</a>
 * <a href="https://bioconductor.org/packages/release/bioc/html/treeio.html">treeio</a>
 * <a href="https://cran.r-project.org/web/packages/tidytree/index.html">tidytree</a></p>
<h2 id="cowplot">cowplot</h2>
<p>Meant to provide publication-ready theme for <strong>gplot2</strong> that requires minimum amount of fiddling with sizes of axis labels, plot backgrounds, etc. Auto-sets <code>theme_classic()</code> for all plots.</p>
<h2 id="gviz-for-plotting-data-along-genomic-coordinates">Gviz for plotting data along genomic coordinates</h2>
<p>Can be installed from <a href="https://bioconductor.org/packages/release/bioc/html/Gviz.html">Bioconductor</a>.</p>
<h2 id="phyloseq-for-metagenomics">phyloseq for metagenomics</h2>
<p>Website is <a href="http://joey711.github.io/phyloseq/">very comprehensive</a>.</p>
<div class="codehilite"><pre><span></span><span class="nf">sessionInfo</span><span class="p">()</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0",url:{base:".."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-115983496-2","compbiocore.github.io"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>